// ==UserScript==
// @name        tEXt chunk preview
// @include     /.*\.(png|jpe?g|webp)(\?.*)?$/
// @grant       none
// @version     1.8
// @namespace   text-chunk-preview
// @author      AntlersAnon
// ==/UserScript==

(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function t(e,t,i,n,r,a,s){try{var o=e[a](s),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function i(e,t,i,n){for(var r=0,a=0;a<8;a++)r<<=1,r|=e[i][t],++i===n&&(t++,i=0);return{byte:r,width:t,height:i}}function n(){var r;return r=function(t){var n,r,a,s,o,l,h,u,c,d,f,p,g,m,b,w,y,_,k,S,v,C,x,A,I,P,T,O;return function(e,t){var i,n,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}(this,(function(D){switch(D.label){case 0:return[4,t.arrayBuffer()];case 1:return r=D.sent(),a=new Uint8Array(r),s=t.headers.get("Content-Type"),o={},l=new Blob([a],{type:s}),[4,createImageBitmap(l)];case 2:for(h=D.sent(),u=document.createElement("canvas"),c=u.getContext("2d"),d=h.width,f=h.height,u.width=d,u.height=f,c.drawImage(h,0,0),p=c.getImageData(0,0,h.width,h.height).data,g=0,m=0,b=3;b<p.length;b+=4)0===m&&(o[g]={}),o[g][m]=1&p[b],++m===d&&(g++,m=0);for(w=0,y=0,k=new Uint8Array,S=0;S<15;S++)v=k,_=i(o,w,y,d),w=_.width,y=_.height,(k=new Uint8Array(k.length+1)).set(v),k.set([_.byte],v.length);if(C=(n=String).fromCharCode.apply(n,function(t){if(Array.isArray(t))return e(t)}(U=k)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(U)||function(t,i){if(t){if("string"==typeof t)return e(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,i):void 0}}(U)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),k=new Uint8Array,"stealth_pngcomp"!==C)return[2];for(x=0;x<4;x++)A=k,_=i(o,w,y,f),w=_.width,y=_.height,(k=new Uint8Array(k.length+1)).set(A),k.set([_.byte],A.length);for(I=new DataView(k.buffer).getInt32(0,!1)/8,k=new Uint8Array,P=0;P<I;P++)T=k,_=i(o,w,y,d),w=_.width,y=_.height,(k=new Uint8Array(k.length+1)).set(T),k.set([_.byte],T.length);return O=pako.ungzip(k),[2,{"alpha layer":(new TextDecoder).decode(O)}]}var U}))},n=function(){var e=this,i=arguments;return new Promise((function(n,a){var s=r.apply(e,i);function o(e){t(s,n,a,o,l,"next",e)}function l(e){t(s,n,a,o,l,"throw",e)}o(void 0)}))},n.apply(this,arguments)}const r=function(e){return n.apply(this,arguments)};var a="undefined"!=typeof self?self:global;const s="undefined"!=typeof navigator,o=s&&"undefined"==typeof HTMLImageElement,l=!("undefined"==typeof global||"undefined"==typeof process||!process.versions||!process.versions.node),h=a.Buffer,u=a.BigInt,c=!!h,d=e=>e;function f(e,t=d){if(l)try{return"function"==typeof require?Promise.resolve(t(require(e))):import(e).then(t)}catch(t){console.warn(`Couldn't load ${e}`)}}let p=a.fetch;if(!a.fetch){const e=f("http",(e=>e)),t=f("https",(e=>e)),i=(n,{headers:r}={})=>new Promise((async(a,s)=>{let{port:o,hostname:l,pathname:h,protocol:u,search:c}=new URL(n);const d={method:"GET",hostname:l,path:encodeURI(h)+c,headers:r};""!==o&&(d.port=Number(o));const f=("https:"===u?await t:await e).request(d,(e=>{if(301===e.statusCode||302===e.statusCode){let t=new URL(e.headers.location,n).toString();return i(t,{headers:r}).then(a).catch(s)}a({status:e.statusCode,arrayBuffer:()=>new Promise((t=>{let i=[];e.on("data",(e=>i.push(e))),e.on("end",(()=>t(Buffer.concat(i))))}))})}));f.on("error",s),f.end()}));(e=>{p=e})(i)}function g(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const m=e=>w(e)?void 0:e,b=e=>void 0!==e;function w(e){return void 0===e||(e instanceof Map?0===e.size:0===Object.values(e).filter(b).length)}function y(e){let t=new Error(e);throw delete t.stack,t}function _(e){return""===(e=function(e){for(;e.endsWith("\0");)e=e.slice(0,-1);return e}(e).trim())?void 0:e}function k(e){let t=function(e){let t=0;return e.ifd0.enabled&&(t+=1024),e.exif.enabled&&(t+=2048),e.makerNote&&(t+=2048),e.userComment&&(t+=1024),e.gps.enabled&&(t+=512),e.interop.enabled&&(t+=100),e.ifd1.enabled&&(t+=1024),t+2048}(e);return e.jfif.enabled&&(t+=50),e.xmp.enabled&&(t+=2e4),e.iptc.enabled&&(t+=14e3),e.icc.enabled&&(t+=6e3),t}const S=e=>String.fromCharCode.apply(null,e),v="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):void 0;function C(e){return v?v.decode(e):c?Buffer.from(e).toString("utf8"):decodeURIComponent(escape(S(e)))}class x{static from(e,t){return e instanceof this&&e.le===t?e:new x(e,void 0,void 0,t)}constructor(e,t=0,i,n){if("boolean"==typeof n&&(this.le=n),Array.isArray(e)&&(e=new Uint8Array(e)),0===e)this.byteOffset=0,this.byteLength=0;else if(e instanceof ArrayBuffer){void 0===i&&(i=e.byteLength-t);let n=new DataView(e,t,i);this._swapDataView(n)}else if(e instanceof Uint8Array||e instanceof DataView||e instanceof x){void 0===i&&(i=e.byteLength-t),(t+=e.byteOffset)+i>e.byteOffset+e.byteLength&&y("Creating view outside of available memory in ArrayBuffer");let n=new DataView(e.buffer,t,i);this._swapDataView(n)}else if("number"==typeof e){let t=new DataView(new ArrayBuffer(e));this._swapDataView(t)}else y("Invalid input argument for BufferView: "+e)}_swapArrayBuffer(e){this._swapDataView(new DataView(e))}_swapBuffer(e){this._swapDataView(new DataView(e.buffer,e.byteOffset,e.byteLength))}_swapDataView(e){this.dataView=e,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength}_lengthToEnd(e){return this.byteLength-e}set(e,t,i=x){return e instanceof DataView||e instanceof x?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array||y("BufferView.set(): Invalid data argument."),this.toUint8().set(e,t),new i(this,t,e.byteLength)}subarray(e,t){return t=t||this._lengthToEnd(e),new x(this,e,t)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(e,t){return new Uint8Array(this.buffer,this.byteOffset+e,t)}getString(e=0,t=this.byteLength){return C(this.getUint8Array(e,t))}getLatin1String(e=0,t=this.byteLength){let i=this.getUint8Array(e,t);return S(i)}getUnicodeString(e=0,t=this.byteLength){const i=[];for(let n=0;n<t&&e+n<this.byteLength;n+=2)i.push(this.getUint16(e+n));return S(i)}getInt8(e){return this.dataView.getInt8(e)}getUint8(e){return this.dataView.getUint8(e)}getInt16(e,t=this.le){return this.dataView.getInt16(e,t)}getInt32(e,t=this.le){return this.dataView.getInt32(e,t)}getUint16(e,t=this.le){return this.dataView.getUint16(e,t)}getUint32(e,t=this.le){return this.dataView.getUint32(e,t)}getFloat32(e,t=this.le){return this.dataView.getFloat32(e,t)}getFloat64(e,t=this.le){return this.dataView.getFloat64(e,t)}getFloat(e,t=this.le){return this.dataView.getFloat32(e,t)}getDouble(e,t=this.le){return this.dataView.getFloat64(e,t)}getUintBytes(e,t,i){switch(t){case 1:return this.getUint8(e,i);case 2:return this.getUint16(e,i);case 4:return this.getUint32(e,i);case 8:return this.getUint64&&this.getUint64(e,i)}}getUint(e,t,i){switch(t){case 8:return this.getUint8(e,i);case 16:return this.getUint16(e,i);case 32:return this.getUint32(e,i);case 64:return this.getUint64&&this.getUint64(e,i)}}toString(e){return this.dataView.toString(e,this.constructor.name)}ensureChunk(){}}function A(e,t){y(`${e} '${t}' was not loaded, try using full build of exifr.`)}class I extends Map{constructor(e){super(),this.kind=e}get(e,t){return this.has(e)||A(this.kind,e),t&&(e in t||function(e,t){y(`Unknown ${e} '${t}'.`)}(this.kind,e),t[e].enabled||A(this.kind,e)),super.get(e)}keyList(){return Array.from(this.keys())}}var P=new I("file parser"),T=new I("segment parser"),O=new I("file reader");function D(e,t){return(i=e).startsWith("data:")||i.length>1e4?R(e,t,"base64"):l&&e.includes("://")?U(e,t,"url",E):l?R(e,t,"fs"):s?U(e,t,"url",E):void y("Invalid input argument");var i}async function U(e,t,i,n){return O.has(i)?R(e,t,i):n?async function(e,t){let i=await t(e);return new x(i)}(e,n):void y(`Parser ${i} is not loaded`)}async function R(e,t,i){let n=new(O.get(i))(e,t);return await n.read(),n}const E=e=>p(e).then((e=>e.arrayBuffer())),L=e=>new Promise(((t,i)=>{let n=new FileReader;n.onloadend=()=>t(n.result||new ArrayBuffer),n.onerror=i,n.readAsArrayBuffer(e)}));class M extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function F(e,t,i){let n=new M;for(let[e,t]of i)n.set(e,t);if(Array.isArray(t))for(let i of t)e.set(i,n);else e.set(t,n);return n}function z(e,t,i){let n,r=e.get(t);for(n of i)r.set(n[0],n[1])}const B=new Map,N=new Map,G=new Map,V=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],j=["jfif","xmp","icc","iptc","ihdr"],H=["tiff",...j],Z=["ifd0","ifd1","exif","gps","interop"],W=[...H,...Z],K=["makerNote","userComment"],X=["translateKeys","translateValues","reviveValues","multiSegment"],Y=[...X,"sanitize","mergeOutput","silentErrors"];class ${get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class J extends ${get needed(){return this.enabled||this.deps.size>0}constructor(e,t,i,n){if(super(),g(this,"enabled",!1),g(this,"skip",new Set),g(this,"pick",new Set),g(this,"deps",new Set),g(this,"translateKeys",!1),g(this,"translateValues",!1),g(this,"reviveValues",!1),this.key=e,this.enabled=t,this.parse=this.enabled,this.applyInheritables(n),this.canBeFiltered=Z.includes(e),this.canBeFiltered&&(this.dict=B.get(e)),void 0!==i)if(Array.isArray(i))this.parse=this.enabled=!0,this.canBeFiltered&&i.length>0&&this.translateTagSet(i,this.pick);else if("object"==typeof i){if(this.enabled=!0,this.parse=!1!==i.parse,this.canBeFiltered){let{pick:e,skip:t}=i;e&&e.length>0&&this.translateTagSet(e,this.pick),t&&t.length>0&&this.translateTagSet(t,this.skip)}this.applyInheritables(i)}else!0===i||!1===i?this.parse=this.enabled=i:y(`Invalid options argument: ${i}`)}applyInheritables(e){let t,i;for(t of X)i=e[t],void 0!==i&&(this[t]=i)}translateTagSet(e,t){if(this.dict){let i,n,{tagKeys:r,tagValues:a}=this.dict;for(i of e)"string"==typeof i?(n=a.indexOf(i),-1===n&&(n=r.indexOf(Number(i))),-1!==n&&t.add(Number(r[n]))):t.add(i)}else for(let i of e)t.add(i)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,ne(this.pick,this.deps)):this.enabled&&this.pick.size>0&&ne(this.pick,this.deps)}}var q={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},Q=new Map;class ee extends ${static useCached(e){let t=Q.get(e);return void 0!==t||(t=new this(e),Q.set(e,t)),t}constructor(e){super(),!0===e?this.setupFromTrue():void 0===e?this.setupFromUndefined():Array.isArray(e)?this.setupFromArray(e):"object"==typeof e?this.setupFromObject(e):y(`Invalid options argument ${e}`),void 0===this.firstChunkSize&&(this.firstChunkSize=s?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let e;for(e of V)this[e]=q[e];for(e of Y)this[e]=q[e];for(e of K)this[e]=q[e];for(e of W)this[e]=new J(e,q[e],void 0,this)}setupFromTrue(){let e;for(e of V)this[e]=q[e];for(e of Y)this[e]=q[e];for(e of K)this[e]=!0;for(e of W)this[e]=new J(e,!0,void 0,this)}setupFromArray(e){let t;for(t of V)this[t]=q[t];for(t of Y)this[t]=q[t];for(t of K)this[t]=q[t];for(t of W)this[t]=new J(t,!1,void 0,this);this.setupGlobalFilters(e,void 0,Z)}setupFromObject(e){let t;for(t of(Z.ifd0=Z.ifd0||Z.image,Z.ifd1=Z.ifd1||Z.thumbnail,Object.assign(this,e),V))this[t]=ie(e[t],q[t]);for(t of Y)this[t]=ie(e[t],q[t]);for(t of K)this[t]=ie(e[t],q[t]);for(t of H)this[t]=new J(t,q[t],e[t],this);for(t of Z)this[t]=new J(t,q[t],e[t],this.tiff);this.setupGlobalFilters(e.pick,e.skip,Z,W),!0===e.tiff?this.batchEnableWithBool(Z,!0):!1===e.tiff?this.batchEnableWithUserValue(Z,e):Array.isArray(e.tiff)?this.setupGlobalFilters(e.tiff,void 0,Z):"object"==typeof e.tiff&&this.setupGlobalFilters(e.tiff.pick,e.tiff.skip,Z)}batchEnableWithBool(e,t){for(let i of e)this[i].enabled=t}batchEnableWithUserValue(e,t){for(let i of e){let e=t[i];this[i].enabled=!1!==e&&void 0!==e}}setupGlobalFilters(e,t,i,n=i){if(e&&e.length){for(let e of n)this[e].enabled=!1;let t=te(e,i);for(let[e,i]of t)ne(this[e].pick,i),this[e].enabled=!0}else if(t&&t.length){let e=te(t,i);for(let[t,i]of e)ne(this[t].skip,i)}}filterNestedSegmentTags(){let{ifd0:e,exif:t,xmp:i,iptc:n,icc:r}=this;this.makerNote?t.deps.add(37500):t.skip.add(37500),this.userComment?t.deps.add(37510):t.skip.add(37510),i.enabled||e.skip.add(700),n.enabled||e.skip.add(33723),r.enabled||e.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:e,exif:t,gps:i,interop:n}=this;n.needed&&(t.deps.add(40965),e.deps.add(40965)),t.needed&&e.deps.add(34665),i.needed&&e.deps.add(34853),this.tiff.enabled=Z.some((e=>!0===this[e].enabled))||this.makerNote||this.userComment;for(let e of Z)this[e].finalizeFilters()}get onlyTiff(){return!j.map((e=>this[e].enabled)).some((e=>!0===e))&&this.tiff.enabled}checkLoadedPlugins(){for(let e of H)this[e].enabled&&!T.has(e)&&A("segment parser",e)}}function te(e,t){let i,n,r,a,s=[];for(r of t){for(a of(i=B.get(r),n=[],i))(e.includes(a[0])||e.includes(a[1]))&&n.push(a[0]);n.length&&s.push([r,n])}return s}function ie(e,t){return void 0!==e?e:void 0!==t?t:void 0}function ne(e,t){for(let i of t)e.add(i)}g(ee,"default",q);class re{constructor(e){g(this,"parsers",{}),g(this,"output",{}),g(this,"errors",[]),g(this,"pushToErrors",(e=>this.errors.push(e))),this.options=ee.useCached(e)}async read(e){this.file=await function(e,t){return"string"==typeof e?D(e,t):s&&!o&&e instanceof HTMLImageElement?D(e.src,t):e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof DataView?new x(e):s&&e instanceof Blob?U(e,t,"blob",L):void y("Invalid input argument")}(e,this.options)}setup(){if(this.fileParser)return;let{file:e}=this,t=e.getUint16(0);for(let[i,n]of P)if(n.canHandle(e,t))return this.fileParser=new n(this.options,this.file,this.parsers),e[i]=!0;this.file.close&&this.file.close(),y("Unknown file format")}async parse(){let{output:e,errors:t}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),t.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&t.length>0&&(e.errors=t),m(e)}async executeParsers(){let{output:e}=this;await this.fileParser.parse();let t=Object.values(this.parsers).map((async t=>{let i=await t.parse();t.assignToOutput(e,i)}));this.options.silentErrors&&(t=t.map((e=>e.catch(this.pushToErrors)))),await Promise.all(t)}async extractThumbnail(){this.setup();let{options:e,file:t}=this,i=T.get("tiff",e);var n;if(t.tiff?n={start:0,type:"tiff"}:t.jpeg&&(n=await this.fileParser.getOrFindSegment("tiff")),void 0===n)return;let r=await this.fileParser.ensureSegmentChunk(n),a=this.parsers.tiff=new i(r,e,t),s=await a.extractThumbnail();return t.close&&t.close(),s}}async function ae(e,t){let i=new re(t);return await i.read(e),i.parse()}var se=Object.freeze({__proto__:null,parse:ae,Exifr:re,fileParsers:P,segmentParsers:T,fileReaders:O,tagKeys:B,tagValues:N,tagRevivers:G,createDictionary:F,extendDictionary:z,fetchUrlAsArrayBuffer:E,readBlobAsArrayBuffer:L,chunkedProps:V,otherSegments:j,segments:H,tiffBlocks:Z,segmentsAndBlocks:W,tiffExtractables:K,inheritables:X,allFormatters:Y,Options:ee});class oe{constructor(e,t,i){g(this,"errors",[]),g(this,"ensureSegmentChunk",(async e=>{let t=e.start,i=e.size||65536;if(this.file.chunked)if(this.file.available(t,i))e.chunk=this.file.subarray(t,i);else try{e.chunk=await this.file.readChunk(t,i)}catch(t){y(`Couldn't read segment: ${JSON.stringify(e)}. ${t.message}`)}else this.file.byteLength>t+i?e.chunk=this.file.subarray(t,i):void 0===e.size?e.chunk=this.file.subarray(t):y("Segment unreachable: "+JSON.stringify(e));return e.chunk})),this.extendOptions&&this.extendOptions(e),this.options=e,this.file=t,this.parsers=i}injectSegment(e,t){this.options[e].enabled&&this.createParser(e,t)}createParser(e,t){let i=new(T.get(e))(t,this.options,this.file);return this.parsers[e]=i}createParsers(e){for(let t of e){let{type:e,chunk:i}=t,n=this.options[e];if(n&&n.enabled){let t=this.parsers[e];t&&t.append||t||this.createParser(e,i)}}}async readSegments(e){let t=e.map(this.ensureSegmentChunk);await Promise.all(t)}}class le{static findPosition(e,t){let i=e.getUint16(t+2)+2,n="function"==typeof this.headerLength?this.headerLength(e,t,i):this.headerLength,r=t+n,a=i-n;return{offset:t,length:i,headerLength:n,start:r,size:a,end:r+a}}static parse(e,t={}){return new this(e,new ee({[this.type]:t}),e).parse()}normalizeInput(e){return e instanceof x?e:new x(e)}constructor(e,t={},i){g(this,"errors",[]),g(this,"raw",new Map),g(this,"handleError",(e=>{if(!this.options.silentErrors)throw e;this.errors.push(e.message)})),this.chunk=this.normalizeInput(e),this.file=i,this.type=this.constructor.type,this.globalOptions=this.options=t,this.localOptions=t[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(e,t){let i=G.get(t),n=N.get(t),r=B.get(t),a=this.options[t],s=a.reviveValues&&!!i,o=a.translateValues&&!!n,l=a.translateKeys&&!!r,h={};for(let[t,a]of e)s&&i.has(t)?a=i.get(t)(a):o&&n.has(t)&&(a=this.translateValue(a,n.get(t))),l&&r.has(t)&&(t=r.get(t)||t),h[t]=a;return h}translateValue(e,t){return t[e]||t.DEFAULT||e}assignToOutput(e,t){this.assignObjectToOutput(e,this.constructor.type,t)}assignObjectToOutput(e,t,i){if(this.globalOptions.mergeOutput)return Object.assign(e,i);e[t]?Object.assign(e[t],i):e[t]=i}}function he(e){return 192===e||194===e||196===e||219===e||221===e||218===e||254===e}function ue(e){return e>=224&&e<=239}function ce(e,t,i){for(let[n,r]of T)if(r.canHandle(e,t,i))return n}g(le,"headerLength",4),g(le,"type",void 0),g(le,"multiSegment",!1),g(le,"canHandle",(()=>!1));class de extends oe{constructor(...e){super(...e),g(this,"appSegments",[]),g(this,"jpegSegments",[]),g(this,"unknownSegments",[])}static canHandle(e,t){return 65496===t}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(e){!0===e?(this.findAll=!0,this.wanted=new Set(T.keyList())):(e=void 0===e?T.keyList().filter((e=>this.options[e].enabled)):e.filter((e=>this.options[e].enabled&&T.has(e))),this.findAll=!1,this.remaining=new Set(e),this.wanted=new Set(e)),this.unfinishedMultiSegment=!1}async findAppSegments(e=0,t){this.setupSegmentFinderArgs(t);let{file:i,findAll:n,wanted:r,remaining:a}=this;if(!n&&this.file.chunked&&(n=Array.from(r).some((e=>{let t=T.get(e),i=this.options[e];return t.multiSegment&&i.multiSegment})),n&&await this.file.readWhole()),e=this.findAppSegmentsInRange(e,i.byteLength),!this.options.onlyTiff&&i.chunked){let t=!1;for(;a.size>0&&!t&&(i.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:n}=i,r=this.appSegments.some((e=>!this.file.available(e.offset||e.start,e.length||e.size)));if(t=e>n&&!r?!await i.readNextChunk(e):!await i.readNextChunk(n),void 0===(e=this.findAppSegmentsInRange(e,i.byteLength)))return}}}findAppSegmentsInRange(e,t){t-=2;let i,n,r,a,s,o,{file:l,findAll:h,wanted:u,remaining:c,options:d}=this;for(;e<t;e++)if(255===l.getUint8(e))if(i=l.getUint8(e+1),ue(i)){if(n=l.getUint16(e+2),r=ce(l,e,n),r&&u.has(r)&&(a=T.get(r),s=a.findPosition(l,e),o=d[r],s.type=r,this.appSegments.push(s),!h&&(a.multiSegment&&o.multiSegment?(this.unfinishedMultiSegment=s.chunkNumber<s.chunkCount,this.unfinishedMultiSegment||c.delete(r)):c.delete(r),0===c.size)))break;d.recordUnknownSegments&&(s=le.findPosition(l,e),s.marker=i,this.unknownSegments.push(s)),e+=n+1}else if(he(i)){if(n=l.getUint16(e+2),218===i&&!1!==d.stopAfterSos)return;d.recordJpegSegments&&this.jpegSegments.push({offset:e,length:n,marker:i}),e+=n+1}return e}mergeMultiSegments(){if(!this.appSegments.some((e=>e.multiSegment)))return;let e=function(e){let t,i,n,r=new Map;for(let a=0;a<e.length;a++)t=e[a],i=t.type,r.has(i)?n=r.get(i):r.set(i,n=[]),n.push(t);return Array.from(r)}(this.appSegments);this.mergedAppSegments=e.map((([e,t])=>{let i=T.get(e,this.options);return i.handleMultiSegments?{type:e,chunk:i.handleMultiSegments(t)}:t[0]}))}getSegment(e){return this.appSegments.find((t=>t.type===e))}async getOrFindSegment(e){let t=this.getSegment(e);return void 0===t&&(await this.findAppSegments(0,[e]),t=this.getSegment(e)),t}}g(de,"type","jpeg"),P.set("jpeg",de);const fe=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class pe extends le{parseHeader(){var e=this.chunk.getUint16();18761===e?this.le=!0:19789===e&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(e,t,i=new Map){let{pick:n,skip:r}=this.options[t];n=new Set(n);let a=n.size>0,s=0===r.size,o=this.chunk.getUint16(e);e+=2;for(let l=0;l<o;l++){let o=this.chunk.getUint16(e);if(a){if(n.has(o)&&(i.set(o,this.parseTag(e,o,t)),n.delete(o),0===n.size))break}else!s&&r.has(o)||i.set(o,this.parseTag(e,o,t));e+=12}return i}parseTag(e,t,i){let{chunk:n}=this,r=n.getUint16(e+2),a=n.getUint32(e+4),s=fe[r];if(s*a<=4?e+=8:e=n.getUint32(e+8),(r<1||r>13)&&y(`Invalid TIFF value type. block: ${i.toUpperCase()}, tag: ${t.toString(16)}, type: ${r}, offset ${e}`),e>n.byteLength&&y(`Invalid TIFF value offset. block: ${i.toUpperCase()}, tag: ${t.toString(16)}, type: ${r}, offset ${e} is outside of chunk size ${n.byteLength}`),1===r)return n.getUint8Array(e,a);if(2===r)return _(n.getString(e,a));if(7===r)return n.getUint8Array(e,a);if(1===a)return this.parseTagValue(r,e);{let t=new(function(e){switch(e){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:case 10:default:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 11:return Float32Array;case 12:return Float64Array}}(r))(a),i=s;for(let n=0;n<a;n++)t[n]=this.parseTagValue(r,e),e+=i;return t}}parseTagValue(e,t){let{chunk:i}=this;switch(e){case 1:return i.getUint8(t);case 3:return i.getUint16(t);case 4:case 13:return i.getUint32(t);case 5:return i.getUint32(t)/i.getUint32(t+4);case 6:return i.getInt8(t);case 8:return i.getInt16(t);case 9:return i.getInt32(t);case 10:return i.getInt32(t)/i.getInt32(t+4);case 11:return i.getFloat(t);case 12:return i.getDouble(t);default:y(`Invalid tiff type ${e}`)}}}class ge extends pe{static canHandle(e,t){return 225===e.getUint8(t+1)&&1165519206===e.getUint32(t+4)&&0===e.getUint16(t+8)}async parse(){this.parseHeader();let{options:e}=this;return e.ifd0.enabled&&await this.parseIfd0Block(),e.exif.enabled&&await this.safeParse("parseExifBlock"),e.gps.enabled&&await this.safeParse("parseGpsBlock"),e.interop.enabled&&await this.safeParse("parseInteropBlock"),e.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(e){let t=this[e]();return void 0!==t.catch&&(t=t.catch(this.handleError)),t}findIfd0Offset(){void 0===this.ifd0Offset&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(void 0===this.ifd1Offset){this.findIfd0Offset();let e=this.chunk.getUint16(this.ifd0Offset),t=this.ifd0Offset+2+12*e;this.ifd1Offset=this.chunk.getUint32(t)}}parseBlock(e,t){let i=new Map;return this[t]=i,this.parseTags(e,t,i),i}async parseIfd0Block(){if(this.ifd0)return;let{file:e}=this;this.findIfd0Offset(),this.ifd0Offset<8&&y("Malformed EXIF data"),!e.chunked&&this.ifd0Offset>e.byteLength&&y(`IFD0 offset points to outside of file.\nthis.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${e.byteLength}`),e.tiff&&await e.ensureChunk(this.ifd0Offset,k(this.options));let t=this.parseBlock(this.ifd0Offset,"ifd0");return 0!==t.size?(this.exifOffset=t.get(34665),this.interopOffset=t.get(40965),this.gpsOffset=t.get(34853),this.xmp=t.get(700),this.iptc=t.get(33723),this.icc=t.get(34675),this.options.sanitize&&(t.delete(34665),t.delete(40965),t.delete(34853),t.delete(700),t.delete(33723),t.delete(34675)),t):void 0}async parseExifBlock(){if(this.exif)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.exifOffset)return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,k(this.options));let e=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=e.get(40965)),this.makerNote=e.get(37500),this.userComment=e.get(37510),this.options.sanitize&&(e.delete(40965),e.delete(37500),e.delete(37510)),this.unpack(e,41728),this.unpack(e,41729),e}unpack(e,t){let i=e.get(t);i&&1===i.length&&e.set(t,i[0])}async parseGpsBlock(){if(this.gps)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.gpsOffset)return;let e=this.parseBlock(this.gpsOffset,"gps");return e&&e.has(2)&&e.has(4)&&(e.set("latitude",me(...e.get(2),e.get(1))),e.set("longitude",me(...e.get(4),e.get(3)))),e}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),void 0!==this.interopOffset||this.exif||await this.parseExifBlock(),void 0!==this.interopOffset))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(e=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||e))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),void 0===this.ifd1)return;let e=this.ifd1.get(513),t=this.ifd1.get(514);return this.chunk.getUint8Array(e,t)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let e,t,i,n={};for(t of Z)if(e=this[t],!w(e))if(i=this.canTranslate?this.translateBlock(e,t):Object.fromEntries(e),this.options.mergeOutput){if("ifd1"===t)continue;Object.assign(n,i)}else n[t]=i;return this.makerNote&&(n.makerNote=this.makerNote),this.userComment&&(n.userComment=this.userComment),n}assignToOutput(e,t){if(this.globalOptions.mergeOutput)Object.assign(e,t);else for(let[i,n]of Object.entries(t))this.assignObjectToOutput(e,i,n)}}function me(e,t,i,n){var r=e+t/60+i/3600;return"S"!==n&&"W"!==n||(r*=-1),r}g(ge,"type","tiff"),g(ge,"headerLength",10),T.set("tiff",ge);var be=Object.freeze({__proto__:null,default:se,Exifr:re,fileParsers:P,segmentParsers:T,fileReaders:O,tagKeys:B,tagValues:N,tagRevivers:G,createDictionary:F,extendDictionary:z,fetchUrlAsArrayBuffer:E,readBlobAsArrayBuffer:L,chunkedProps:V,otherSegments:j,segments:H,tiffBlocks:Z,segmentsAndBlocks:W,tiffExtractables:K,inheritables:X,allFormatters:Y,Options:ee,parse:ae});const we={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},ye=Object.assign({},we,{firstChunkSize:4e4,gps:[1,2,3,4]});async function _e(e){let t=new re(ye);await t.read(e);let i=await t.parse();if(i&&i.gps){let{latitude:e,longitude:t}=i.gps;return{latitude:e,longitude:t}}}const ke=Object.assign({},we,{tiff:!1,ifd1:!0,mergeOutput:!1});async function Se(e){let t=new re(ke);await t.read(e);let i=await t.extractThumbnail();return i&&c?h.from(i):i}async function ve(e){let t=await this.thumbnail(e);if(void 0!==t){let e=new Blob([t]);return URL.createObjectURL(e)}}const Ce=Object.assign({},we,{firstChunkSize:4e4,ifd0:[274]});async function xe(e){let t=new re(Ce);await t.read(e);let i=await t.parse();if(i&&i.ifd0)return i.ifd0[274]}const Ae=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let Ie=!0,Pe=!0;if("object"==typeof navigator){let e=navigator.userAgent;if(e.includes("iPad")||e.includes("iPhone")){let t=e.match(/OS (\d+)_(\d+)/);if(t){let[,e,i]=t,n=Number(e)+.1*Number(i);Ie=n<13.4,Pe=!1}}else if(e.includes("OS X 10")){let[,t]=e.match(/OS X 10[_.](\d+)/);Ie=Pe=Number(t)<15}if(e.includes("Chrome/")){let[,t]=e.match(/Chrome\/(\d+)/);Ie=Pe=Number(t)<81}else if(e.includes("Firefox/")){let[,t]=e.match(/Firefox\/(\d+)/);Ie=Pe=Number(t)<77}}async function Te(e){let t=await xe(e);return Object.assign({canvas:Ie,css:Pe},Ae[t])}class Oe extends x{constructor(...e){super(...e),g(this,"ranges",new De),0!==this.byteLength&&this.ranges.add(0,this.byteLength)}_tryExtend(e,t,i){if(0===e&&0===this.byteLength&&i){let e=new DataView(i.buffer||i,i.byteOffset,i.byteLength);this._swapDataView(e)}else{let i=e+t;if(i>this.byteLength){let{dataView:e}=this._extend(i);this._swapDataView(e)}}}_extend(e){let t;t=c?h.allocUnsafe(e):new Uint8Array(e);let i=new DataView(t.buffer,t.byteOffset,t.byteLength);return t.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:t,dataView:i}}subarray(e,t,i=!1){return t=t||this._lengthToEnd(e),i&&this._tryExtend(e,t),this.ranges.add(e,t),super.subarray(e,t)}set(e,t,i=!1){i&&this._tryExtend(t,e.byteLength,e);let n=super.set(e,t);return this.ranges.add(t,n.byteLength),n}async ensureChunk(e,t){this.chunked&&(this.ranges.available(e,t)||await this.readChunk(e,t))}available(e,t){return this.ranges.available(e,t)}}class De{constructor(){g(this,"list",[])}get length(){return this.list.length}add(e,t,i=0){let n=e+t,r=this.list.filter((t=>Ue(e,t.offset,n)||Ue(e,t.end,n)));if(r.length>0){e=Math.min(e,...r.map((e=>e.offset))),n=Math.max(n,...r.map((e=>e.end))),t=n-e;let i=r.shift();i.offset=e,i.length=t,i.end=n,this.list=this.list.filter((e=>!r.includes(e)))}else this.list.push({offset:e,length:t,end:n})}available(e,t){let i=e+t;return this.list.some((t=>t.offset<=e&&i<=t.end))}}function Ue(e,t,i){return e<=t&&t<=i}class Re extends Oe{constructor(e,t){super(0),g(this,"chunksRead",0),this.input=e,this.options=t}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(e=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let t=this.options.chunkSize,i=await this.readChunk(e,t);return!!i&&i.byteLength===t}async readChunk(e,t){if(this.chunksRead++,0!==(t=this.safeWrapAddress(e,t)))return this._readChunk(e,t)}safeWrapAddress(e,t){return void 0!==this.size&&e+t>this.size?Math.max(0,this.size-e):t}get nextChunkOffset(){if(0!==this.ranges.list.length)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return void 0!==this.size&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}O.set("blob",class extends Re{async readWhole(){this.chunked=!1;let e=await L(this.input);this._swapArrayBuffer(e)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(e,t){let i=t?e+t:void 0,n=this.input.slice(e,i),r=await L(n);return this.set(r,e,!0)}});var Ee=Object.freeze({__proto__:null,default:be,Exifr:re,fileParsers:P,segmentParsers:T,fileReaders:O,tagKeys:B,tagValues:N,tagRevivers:G,createDictionary:F,extendDictionary:z,fetchUrlAsArrayBuffer:E,readBlobAsArrayBuffer:L,chunkedProps:V,otherSegments:j,segments:H,tiffBlocks:Z,segmentsAndBlocks:W,tiffExtractables:K,inheritables:X,allFormatters:Y,Options:ee,parse:ae,gpsOnlyOptions:ye,gps:_e,thumbnailOnlyOptions:ke,thumbnail:Se,thumbnailUrl:ve,orientationOnlyOptions:Ce,orientation:xe,rotations:Ae,get rotateCanvas(){return Ie},get rotateCss(){return Pe},rotation:Te});O.set("url",class extends Re{async readWhole(){this.chunked=!1;let e=await E(this.input);e instanceof ArrayBuffer?this._swapArrayBuffer(e):e instanceof Uint8Array&&this._swapBuffer(e)}async _readChunk(e,t){let i=t?e+t-1:void 0,n=this.options.httpHeaders||{};(e||i)&&(n.range=`bytes=${[e,i].join("-")}`);let r=await p(this.input,{headers:n}),a=await r.arrayBuffer(),s=a.byteLength;if(416!==r.status)return s!==t&&(this.size=e+s),this.set(a,e,!0)}}),x.prototype.getUint64=function(e){let t=this.getUint32(e),i=this.getUint32(e+4);return t<1048575?t<<32|i:void 0!==typeof u?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),u(t)<<u(32)|u(i)):void y("Trying to read 64b value but JS can only handle 53b numbers.")};class Le extends oe{parseBoxes(e=0){let t=[];for(;e<this.file.byteLength-4;){let i=this.parseBoxHead(e);if(t.push(i),0===i.length)break;e+=i.length}return t}parseSubBoxes(e){e.boxes=this.parseBoxes(e.start)}findBox(e,t){return void 0===e.boxes&&this.parseSubBoxes(e),e.boxes.find((e=>e.kind===t))}parseBoxHead(e){let t=this.file.getUint32(e),i=this.file.getString(e+4,4),n=e+8;return 1===t&&(t=this.file.getUint64(e+8),n+=8),{offset:e,length:t,kind:i,start:n}}parseBoxFullHead(e){if(void 0!==e.version)return;let t=this.file.getUint32(e.start);e.version=t>>24,e.start+=4}}class Me extends Le{static canHandle(e,t){if(0!==t)return!1;let i=e.getUint16(2);if(i>50)return!1;let n=16,r=[];for(;n<i;)r.push(e.getString(n,4)),n+=4;return r.includes(this.type)}async parse(){let e=this.file.getUint32(0),t=this.parseBoxHead(e);for(;"meta"!==t.kind;)e+=t.length,await this.file.ensureChunk(e,16),t=this.parseBoxHead(e);await this.file.ensureChunk(t.offset,t.length),this.parseBoxFullHead(t),this.parseSubBoxes(t),this.options.icc.enabled&&await this.findIcc(t),this.options.tiff.enabled&&await this.findExif(t)}async registerSegment(e,t,i){await this.file.ensureChunk(t,i);let n=this.file.subarray(t,i);this.createParser(e,n)}async findIcc(e){let t=this.findBox(e,"iprp");if(void 0===t)return;let i=this.findBox(t,"ipco");if(void 0===i)return;let n=this.findBox(i,"colr");void 0!==n&&await this.registerSegment("icc",n.offset+12,n.length)}async findExif(e){let t=this.findBox(e,"iinf");if(void 0===t)return;let i=this.findBox(e,"iloc");if(void 0===i)return;let n=this.findExifLocIdInIinf(t),r=this.findExtentInIloc(i,n);if(void 0===r)return;let[a,s]=r;await this.file.ensureChunk(a,s);let o=4+this.file.getUint32(a);a+=o,s-=o,await this.registerSegment("tiff",a,s)}findExifLocIdInIinf(e){this.parseBoxFullHead(e);let t,i,n,r,a=e.start,s=this.file.getUint16(a);for(a+=2;s--;){if(t=this.parseBoxHead(a),this.parseBoxFullHead(t),i=t.start,t.version>=2&&(n=3===t.version?4:2,r=this.file.getString(i+n+2,4),"Exif"===r))return this.file.getUintBytes(i,n);a+=t.length}}get8bits(e){let t=this.file.getUint8(e);return[t>>4,15&t]}findExtentInIloc(e,t){this.parseBoxFullHead(e);let i=e.start,[n,r]=this.get8bits(i++),[a,s]=this.get8bits(i++),o=2===e.version?4:2,l=1===e.version||2===e.version?2:0,h=s+n+r,u=2===e.version?4:2,c=this.file.getUintBytes(i,u);for(i+=u;c--;){let e=this.file.getUintBytes(i,o);i+=o+l+2+a;let u=this.file.getUint16(i);if(i+=2,e===t)return u>1&&console.warn("ILOC box has more than one extent but we're only processing one\nPlease create an issue at https://github.com/MikeKovarik/exifr with this file"),[this.file.getUintBytes(i+s,n),this.file.getUintBytes(i+s+n,r)];i+=u*h}}}class Fe extends Me{}g(Fe,"type","heic");class ze extends Me{}g(ze,"type","avif"),P.set("heic",Fe),P.set("avif",ze),F(B,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),F(B,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),F(B,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),F(N,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let Be=F(N,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const Ne={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};Be.set(37392,Ne),Be.set(41488,Ne);const Ge={0:"Normal",1:"Low",2:"High"};function Ve(e){return"object"==typeof e&&void 0!==e.length?e[0]:e}function je(e){let t=Array.from(e).slice(1);return t[1]>15&&(t=t.map((e=>String.fromCharCode(e)))),"0"!==t[2]&&0!==t[2]||t.pop(),t.join(".")}function He(e){if("string"==typeof e){var[t,i,n,r,a,s]=e.trim().split(/[-: ]/g).map(Number),o=new Date(t,i-1,n);return Number.isNaN(r)||Number.isNaN(a)||Number.isNaN(s)||(o.setHours(r),o.setMinutes(a),o.setSeconds(s)),Number.isNaN(+o)?e:o}}function Ze(e){if("string"==typeof e)return e;let t=[];if(0===e[1]&&0===e[e.length-1])for(let i=0;i<e.length;i+=2)t.push(We(e[i+1],e[i]));else for(let i=0;i<e.length;i+=2)t.push(We(e[i],e[i+1]));return _(String.fromCodePoint(...t))}function We(e,t){return e<<8|t}Be.set(41992,Ge),Be.set(41993,Ge),Be.set(41994,Ge),F(G,["ifd0","ifd1"],[[50827,function(e){return"string"!=typeof e?C(e):e}],[306,He],[40091,Ze],[40092,Ze],[40093,Ze],[40094,Ze],[40095,Ze]]),F(G,"exif",[[40960,je],[36864,je],[36867,He],[36868,He],[40962,Ve],[40963,Ve]]),F(G,"gps",[[0,e=>Array.from(e).join(".")],[7,e=>Array.from(e).join(":")]]);class Ke extends le{static canHandle(e,t){return 225===e.getUint8(t+1)&&1752462448===e.getUint32(t+4)&&"http://ns.adobe.com/"===e.getString(t+4,20)}static headerLength(e,t){return"http://ns.adobe.com/xmp/extension/"===e.getString(t+4,34)?79:33}static findPosition(e,t){let i=super.findPosition(e,t);return i.multiSegment=i.extended=79===i.headerLength,i.multiSegment?(i.chunkCount=e.getUint8(t+72),i.chunkNumber=e.getUint8(t+76),0!==e.getUint8(t+77)&&i.chunkNumber++):(i.chunkCount=1/0,i.chunkNumber=-1),i}static handleMultiSegments(e){return e.map((e=>e.chunk.getString())).join("")}normalizeInput(e){return"string"==typeof e?e:x.from(e).getString()}parse(e=this.chunk){if(!this.localOptions.parse)return e;e=function(e){let t={},i={};for(let e of it)t[e]=[],i[e]=0;return e.replace(nt,((e,n,r)=>{if("<"===n){let n=++i[r];return t[r].push(n),`${e}#${n}`}return`${e}#${t[r].pop()}`}))}(e);let t=Ye.findAll(e,"rdf","Description");0===t.length&&t.push(new Ye("rdf","Description",void 0,e));let i,n={};for(let e of t)for(let t of e.properties)i=Qe(t.ns,n),$e(t,i);return function(e){let t;for(let i in e)t=e[i]=m(e[i]),void 0===t&&delete e[i];return m(e)}(n)}assignToOutput(e,t){if(this.localOptions.parse)for(let[i,n]of Object.entries(t))switch(i){case"tiff":this.assignObjectToOutput(e,"ifd0",n);break;case"exif":this.assignObjectToOutput(e,"exif",n);break;case"xmlns":break;default:this.assignObjectToOutput(e,i,n)}else e.xmp=t}}g(Ke,"type","xmp"),g(Ke,"multiSegment",!0),T.set("xmp",Ke);class Xe{static findAll(e){return et(e,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(Xe.unpackMatch)}static unpackMatch(e){let t=e[1],i=e[2],n=e[3].slice(1,-1);return n=tt(n),new Xe(t,i,n)}constructor(e,t,i){this.ns=e,this.name=t,this.value=i}serialize(){return this.value}}class Ye{static findAll(e,t,i){if(void 0!==t||void 0!==i){t=t||"[\\w\\d-]+",i=i||"[\\w\\d-]+";var n=new RegExp(`<(${t}):(${i})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else n=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return et(e,n).map(Ye.unpackMatch)}static unpackMatch(e){let t=e[1],i=e[2],n=e[4],r=e[8];return new Ye(t,i,n,r)}constructor(e,t,i,n){this.ns=e,this.name=t,this.attrString=i,this.innerXml=n,this.attrs=Xe.findAll(i),this.children=Ye.findAll(n),this.value=0===this.children.length?tt(n):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return void 0!==this.value&&0===this.attrs.length&&0===this.children.length}get isListContainer(){return 1===this.children.length&&this.children[0].isList}get isList(){let{ns:e,name:t}=this;return"rdf"===e&&("Seq"===t||"Bag"===t||"Alt"===t)}get isListItem(){return"rdf"===this.ns&&"li"===this.name}serialize(){if(0===this.properties.length&&void 0===this.value)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return qe(this.children.map(Je));if(this.isListItem&&1===this.children.length&&0===this.attrs.length)return this.children[0].serialize();let e={};for(let t of this.properties)$e(t,e);return void 0!==this.value&&(e.value=this.value),m(e)}}function $e(e,t){let i=e.serialize();void 0!==i&&(t[e.name]=i)}var Je=e=>e.serialize(),qe=e=>1===e.length?e[0]:e,Qe=(e,t)=>t[e]?t[e]:t[e]={};function et(e,t){let i,n=[];if(!e)return n;for(;null!==(i=t.exec(e));)n.push(i);return n}function tt(e){if(function(e){return null==e||"null"===e||"undefined"===e||""===e||""===e.trim()}(e))return;let t=Number(e);if(!Number.isNaN(t))return t;let i=e.toLowerCase();return"true"===i||"false"!==i&&e.trim()}const it=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],nt=new RegExp(`(<|\\/)(${it.join("|")})`,"g");Object.freeze({__proto__:null,default:Ee,Exifr:re,fileParsers:P,segmentParsers:T,fileReaders:O,tagKeys:B,tagValues:N,tagRevivers:G,createDictionary:F,extendDictionary:z,fetchUrlAsArrayBuffer:E,readBlobAsArrayBuffer:L,chunkedProps:V,otherSegments:j,segments:H,tiffBlocks:Z,segmentsAndBlocks:W,tiffExtractables:K,inheritables:X,allFormatters:Y,Options:ee,parse:ae,gpsOnlyOptions:ye,gps:_e,thumbnailOnlyOptions:ke,thumbnail:Se,thumbnailUrl:ve,orientationOnlyOptions:Ce,orientation:xe,rotations:Ae,get rotateCanvas(){return Ie},get rotateCss(){return Pe},rotation:Te});let rt=f("fs",(e=>e.promises));O.set("fs",class extends Re{async readWhole(){this.chunked=!1,this.fs=await rt;let e=await this.fs.readFile(this.input);this._swapBuffer(e)}async readChunked(){this.chunked=!0,this.fs=await rt,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){void 0===this.fh&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(e,t){void 0===this.fh&&await this.open(),e+t>this.size&&(t=this.size-e);var i=this.subarray(e,t,!0);return await this.fh.read(i.dataView,0,t,e),i}async close(){if(this.fh){let e=this.fh;this.fh=void 0,await e.close()}}}),O.set("base64",class extends Re{constructor(...e){super(...e),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(e,t){let i,n,r=this.input;void 0===e?(e=0,i=0,n=0):(i=4*Math.floor(e/3),n=e-i/4*3),void 0===t&&(t=this.size);let a=e+t,s=i+4*Math.ceil(a/3);r=r.slice(i,s);let o=Math.min(t,this.size-e);if(c){let t=h.from(r,"base64").slice(n,n+o);return this.set(t,e,!0)}{let t=this.subarray(e,o,!0),i=atob(r),a=t.toUint8();for(let e=0;e<o;e++)a[e]=i.charCodeAt(n+e);return t}}});class at extends oe{static canHandle(e,t){return 18761===t||19789===t}extendOptions(e){let{ifd0:t,xmp:i,iptc:n,icc:r}=e;i.enabled&&t.deps.add(700),n.enabled&&t.deps.add(33723),r.enabled&&t.deps.add(34675),t.finalizeFilters()}async parse(){let{tiff:e,xmp:t,iptc:i,icc:n}=this.options;if(e.enabled||t.enabled||i.enabled||n.enabled){let e=Math.max(k(this.options),this.options.chunkSize);await this.file.ensureChunk(0,e),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(e){if(this.parsers.tiff[e]){let t=this.parsers.tiff[e];this.injectSegment(e,t)}}}g(at,"type","tiff"),P.set("tiff",at);let st=f("zlib");const ot=["ihdr","iccp","text","itxt","exif"];class lt extends oe{constructor(...e){super(...e),g(this,"catchError",(e=>this.errors.push(e))),g(this,"metaChunks",[]),g(this,"unknownChunks",[])}static canHandle(e,t){return 35152===t&&2303741511===e.getUint32(0)&&218765834===e.getUint32(4)}async parse(){let{file:e}=this;await this.findPngChunksInRange(8,e.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(e,t){let{file:i}=this;for(;e<t;){let t=i.getUint32(e),n=i.getUint32(e+4),r=i.getString(e+4,4).toLowerCase(),a=t+4+4+4,s={type:r,offset:e,length:a,start:e+4+4,size:t,marker:n};ot.includes(r)?this.metaChunks.push(s):this.unknownChunks.push(s),e+=a}}parseTextChunks(){let e=this.metaChunks.filter((e=>"text"===e.type));for(let t of e){let[e,i]=this.file.getString(t.start,t.size).split("\0");this.injectKeyValToIhdr(e,i)}}injectKeyValToIhdr(e,t){let i=this.parsers.ihdr;i&&i.raw.set(e,t)}findIhdr(){let e=this.metaChunks.find((e=>"ihdr"===e.type));e&&!1!==this.options.ihdr.enabled&&this.createParser("ihdr",e.chunk)}async findExif(){let e=this.metaChunks.find((e=>"exif"===e.type));e&&this.injectSegment("tiff",e.chunk)}async findXmp(){let e=this.metaChunks.filter((e=>"itxt"===e.type));for(let t of e)"XML:com.adobe.xmp"===t.chunk.getString(0,17)&&this.injectSegment("xmp",t.chunk)}async findIcc(){let e=this.metaChunks.find((e=>"iccp"===e.type));if(!e)return;let{chunk:t}=e,i=t.getUint8Array(0,81),n=0;for(;n<80&&0!==i[n];)n++;let r=n+2,a=t.getString(0,n);if(this.injectKeyValToIhdr("ProfileName",a),l){let e=await st,i=t.getUint8Array(r);i=e.inflateSync(i),this.injectSegment("icc",i)}}}g(lt,"type","png"),P.set("png",lt),F(B,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),z(B,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let ht=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];z(B,"ifd0",ht),z(B,"exif",ht),F(N,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class ut extends le{static canHandle(e,t){return 224===e.getUint8(t+1)&&1246120262===e.getUint32(t+4)&&0===e.getUint8(t+8)}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}g(ut,"type","jfif"),g(ut,"headerLength",9),T.set("jfif",ut),F(B,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class ct extends le{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}g(ct,"type","ihdr"),T.set("ihdr",ct),F(B,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),F(N,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class dt extends le{static canHandle(e,t){return 226===e.getUint8(t+1)&&1229144927===e.getUint32(t+4)}static findPosition(e,t){let i=super.findPosition(e,t);return i.chunkNumber=e.getUint8(t+16),i.chunkCount=e.getUint8(t+17),i.multiSegment=i.chunkCount>1,i}static handleMultiSegments(e){return function(e){let t=function(e){let t=e[0].constructor,i=0;for(let t of e)i+=t.length;let n=new t(i),r=0;for(let t of e)n.set(t,r),r+=t.length;return n}(e.map((e=>e.chunk.toUint8())));return new x(t)}(e)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:e}=this;this.chunk.byteLength<84&&y("ICC header is too short");for(let[t,i]of Object.entries(ft)){t=parseInt(t,10);let n=i(this.chunk,t);"\0\0\0\0"!==n&&e.set(t,n)}}parseTags(){let e,t,i,n,r,{raw:a}=this,s=this.chunk.getUint32(128),o=132,l=this.chunk.byteLength;for(;s--;){if(e=this.chunk.getString(o,4),t=this.chunk.getUint32(o+4),i=this.chunk.getUint32(o+8),n=this.chunk.getString(t,4),t+i>l)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");r=this.parseTag(n,t,i),void 0!==r&&"\0\0\0\0"!==r&&a.set(e,r),o+=12}}parseTag(e,t,i){switch(e){case"desc":return this.parseDesc(t);case"mluc":return this.parseMluc(t);case"text":return this.parseText(t,i);case"sig ":return this.parseSig(t)}if(!(t+i>this.chunk.byteLength))return this.chunk.getUint8Array(t,i)}parseDesc(e){let t=this.chunk.getUint32(e+8)-1;return _(this.chunk.getString(e+12,t))}parseText(e,t){return _(this.chunk.getString(e+8,t-8))}parseSig(e){return _(this.chunk.getString(e+8,4))}parseMluc(e){let{chunk:t}=this,i=t.getUint32(e+8),n=t.getUint32(e+12),r=e+16,a=[];for(let s=0;s<i;s++){let i=t.getString(r+0,2),s=t.getString(r+2,2),o=t.getUint32(r+4),l=t.getUint32(r+8)+e,h=_(t.getUnicodeString(l,o));a.push({lang:i,country:s,text:h}),r+=n}return 1===i?a[0].text:a}translateValue(e,t){return"string"==typeof e?t[e]||t[e.toLowerCase()]||e:t[e]||e}}g(dt,"type","icc"),g(dt,"multiSegment",!0),g(dt,"headerLength",18);const ft={4:pt,8:function(e,t){return[e.getUint8(t),e.getUint8(t+1)>>4,e.getUint8(t+1)%16].map((e=>e.toString(10))).join(".")},12:pt,16:pt,20:pt,24:function(e,t){const i=e.getUint16(t),n=e.getUint16(t+2)-1,r=e.getUint16(t+4),a=e.getUint16(t+6),s=e.getUint16(t+8),o=e.getUint16(t+10);return new Date(Date.UTC(i,n,r,a,s,o))},36:pt,40:pt,48:pt,52:pt,64:(e,t)=>e.getUint32(t),80:pt};function pt(e,t){return _(e.getString(t,4))}T.set("icc",dt),F(B,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const gt={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},mt={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};F(N,"icc",[[4,gt],[12,mt],[40,Object.assign({},gt,mt)],[48,gt],[80,gt],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class bt extends le{static canHandle(e,t,i){return 237===e.getUint8(t+1)&&"Photoshop"===e.getString(t+4,9)&&void 0!==this.containsIptc8bim(e,t,i)}static headerLength(e,t,i){let n,r=this.containsIptc8bim(e,t,i);if(void 0!==r)return n=e.getUint8(t+r+7),n%2!=0&&(n+=1),0===n&&(n=4),r+8+n}static containsIptc8bim(e,t,i){for(let n=0;n<i;n++)if(this.isIptcSegmentHead(e,t+n))return n}static isIptcSegmentHead(e,t){return 56===e.getUint8(t)&&943868237===e.getUint32(t)&&1028===e.getUint16(t+4)}parse(){let{raw:e}=this,t=this.chunk.byteLength-1,i=!1;for(let n=0;n<t;n++)if(28===this.chunk.getUint8(n)&&2===this.chunk.getUint8(n+1)){i=!0;let t=this.chunk.getUint16(n+3),r=this.chunk.getUint8(n+2),a=this.chunk.getLatin1String(n+5,t);e.set(r,this.pluralizeValue(e.get(r),a)),n+=4+t}else if(i)break;return this.translate(),this.output}pluralizeValue(e,t){return void 0!==e?e instanceof Array?(e.push(t),e):[e,t]:t}}function wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function yt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _t(e){return function(e){if(Array.isArray(e))return wt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return wt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?wt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}g(bt,"type","iptc"),g(bt,"translateValues",!1),g(bt,"reviveValues",!1),T.set("iptc",bt),F(B,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),F(N,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);const kt=function(e){var t,i,n,r=null==e?void 0:e.userComment;if(i=!r,(null!=(n=Uint8Array)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](i):i instanceof n)||"string"==typeof r)return e;var a=r.slice(0,8),s=(t=String).fromCharCode.apply(t,_t(a)),o=r.slice(8);switch(s){case"ASCII\0\0\0":var l;r=(l=String).fromCharCode.apply(l,_t(o)).replace(/\0/g,"").trim();case"UNICODE\0":r=new TextDecoder("utf-16be").decode(new Uint8Array(o)).replace(/\0/g,"").trim();default:r=new TextDecoder("utf-8").decode(new Uint8Array(o)).replace(/\0/g,"").trim()}return delete e.userComment,e=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),n.forEach((function(t){yt(e,t,i[t])}))}return e}({userComment:r},e),e};function St(e,t,i,n,r,a,s){try{var o=e[a](s),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function vt(){var e;return e=function(e){var t,i;return function(e,t){var i,n,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}(this,(function(n){switch(n.label){case 0:return[4,e.blob()];case 1:t=n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,ae(t,{userComment:!0})];case 3:return i=n.sent(),[3,5];case 4:return n.sent(),[3,5];case 5:return i?[2,kt(i)]:[2,{}]}}))},vt=function(){var t=this,i=arguments;return new Promise((function(n,r){var a=e.apply(t,i);function s(e){St(a,n,r,s,o,"next",e)}function o(e){St(a,n,r,s,o,"throw",e)}s(void 0)}))},vt.apply(this,arguments)}const Ct=function(e){return vt.apply(this,arguments)};function xt(e){let t=e.length;for(;--t>=0;)e[t]=0}const At=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),It=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Pt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Tt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ot=new Array(576);xt(Ot);const Dt=new Array(60);xt(Dt);const Ut=new Array(512);xt(Ut);const Rt=new Array(256);xt(Rt);const Et=new Array(29);xt(Et);const Lt=new Array(30);function Mt(e,t,i,n,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=e&&e.length}let Ft,zt,Bt;function Nt(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}xt(Lt);const Gt=e=>e<256?Ut[e]:Ut[256+(e>>>7)],Vt=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},jt=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,Vt(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},Ht=(e,t,i)=>{jt(e,i[2*t],i[2*t+1])},Zt=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},Wt=(e,t,i)=>{const n=new Array(16);let r,a,s=0;for(r=1;r<=15;r++)s=s+i[r-1]<<1,n[r]=s;for(a=0;a<=t;a++){let t=e[2*a+1];0!==t&&(e[2*a]=Zt(n[t]++,t))}},Kt=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Xt=e=>{e.bi_valid>8?Vt(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Yt=(e,t,i,n)=>{const r=2*t,a=2*i;return e[r]<e[a]||e[r]===e[a]&&n[t]<=n[i]},$t=(e,t,i)=>{const n=e.heap[i];let r=i<<1;for(;r<=e.heap_len&&(r<e.heap_len&&Yt(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!Yt(t,n,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=n},Jt=(e,t,i)=>{let n,r,a,s,o=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+o++],n+=(255&e.pending_buf[e.sym_buf+o++])<<8,r=e.pending_buf[e.sym_buf+o++],0===n?Ht(e,r,t):(a=Rt[r],Ht(e,a+256+1,t),s=At[a],0!==s&&(r-=Et[a],jt(e,r,s)),n--,a=Gt(n),Ht(e,a,i),s=It[a],0!==s&&(n-=Lt[a],jt(e,n,s)))}while(o<e.sym_next);Ht(e,256,t)},qt=(e,t)=>{const i=t.dyn_tree,n=t.stat_desc.static_tree,r=t.stat_desc.has_stree,a=t.stat_desc.elems;let s,o,l,h=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<a;s++)0!==i[2*s]?(e.heap[++e.heap_len]=h=s,e.depth[s]=0):i[2*s+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=h<2?++h:0,i[2*l]=1,e.depth[l]=0,e.opt_len--,r&&(e.static_len-=n[2*l+1]);for(t.max_code=h,s=e.heap_len>>1;s>=1;s--)$t(e,i,s);l=a;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],$t(e,i,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,i[2*l]=i[2*s]+i[2*o],e.depth[l]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,i[2*s+1]=i[2*o+1]=l,e.heap[1]=l++,$t(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,n=t.max_code,r=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let h,u,c,d,f,p,g=0;for(d=0;d<=15;d++)e.bl_count[d]=0;for(i[2*e.heap[e.heap_max]+1]=0,h=e.heap_max+1;h<573;h++)u=e.heap[h],d=i[2*i[2*u+1]+1]+1,d>l&&(d=l,g++),i[2*u+1]=d,u>n||(e.bl_count[d]++,f=0,u>=o&&(f=s[u-o]),p=i[2*u],e.opt_len+=p*(d+f),a&&(e.static_len+=p*(r[2*u+1]+f)));if(0!==g){do{for(d=l-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[l]--,g-=2}while(g>0);for(d=l;0!==d;d--)for(u=e.bl_count[d];0!==u;)c=e.heap[--h],c>n||(i[2*c+1]!==d&&(e.opt_len+=(d-i[2*c+1])*i[2*c],i[2*c+1]=d),u--)}})(e,t),Wt(i,h,e.bl_count)},Qt=(e,t,i)=>{let n,r,a=-1,s=t[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),t[2*(i+1)+1]=65535,n=0;n<=i;n++)r=s,s=t[2*(n+1)+1],++o<l&&r===s||(o<h?e.bl_tree[2*r]+=o:0!==r?(r!==a&&e.bl_tree[2*r]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=r,0===s?(l=138,h=3):r===s?(l=6,h=3):(l=7,h=4))},ei=(e,t,i)=>{let n,r,a=-1,s=t[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),n=0;n<=i;n++)if(r=s,s=t[2*(n+1)+1],!(++o<l&&r===s)){if(o<h)do{Ht(e,r,e.bl_tree)}while(0!=--o);else 0!==r?(r!==a&&(Ht(e,r,e.bl_tree),o--),Ht(e,16,e.bl_tree),jt(e,o-3,2)):o<=10?(Ht(e,17,e.bl_tree),jt(e,o-3,3)):(Ht(e,18,e.bl_tree),jt(e,o-11,7));o=0,a=r,0===s?(l=138,h=3):r===s?(l=6,h=3):(l=7,h=4)}};let ti=!1;const ii=(e,t,i,n)=>{jt(e,0+(n?1:0),3),Xt(e),Vt(e,i),Vt(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i};var ni={_tr_init:e=>{ti||((()=>{let e,t,i,n,r;const a=new Array(16);for(i=0,n=0;n<28;n++)for(Et[n]=i,e=0;e<1<<At[n];e++)Rt[i++]=n;for(Rt[i-1]=n,r=0,n=0;n<16;n++)for(Lt[n]=r,e=0;e<1<<It[n];e++)Ut[r++]=n;for(r>>=7;n<30;n++)for(Lt[n]=r<<7,e=0;e<1<<It[n]-7;e++)Ut[256+r++]=n;for(t=0;t<=15;t++)a[t]=0;for(e=0;e<=143;)Ot[2*e+1]=8,e++,a[8]++;for(;e<=255;)Ot[2*e+1]=9,e++,a[9]++;for(;e<=279;)Ot[2*e+1]=7,e++,a[7]++;for(;e<=287;)Ot[2*e+1]=8,e++,a[8]++;for(Wt(Ot,287,a),e=0;e<30;e++)Dt[2*e+1]=5,Dt[2*e]=Zt(e,5);Ft=new Mt(Ot,At,257,286,15),zt=new Mt(Dt,It,0,30,15),Bt=new Mt(new Array(0),Pt,0,19,7)})(),ti=!0),e.l_desc=new Nt(e.dyn_ltree,Ft),e.d_desc=new Nt(e.dyn_dtree,zt),e.bl_desc=new Nt(e.bl_tree,Bt),e.bi_buf=0,e.bi_valid=0,Kt(e)},_tr_stored_block:ii,_tr_flush_block:(e,t,i,n)=>{let r,a,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),qt(e,e.l_desc),qt(e,e.d_desc),s=(e=>{let t;for(Qt(e,e.dyn_ltree,e.l_desc.max_code),Qt(e,e.dyn_dtree,e.d_desc.max_code),qt(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Tt[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),r=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=r&&(r=a)):r=a=i+5,i+4<=r&&-1!==t?ii(e,t,i,n):4===e.strategy||a===r?(jt(e,2+(n?1:0),3),Jt(e,Ot,Dt)):(jt(e,4+(n?1:0),3),((e,t,i,n)=>{let r;for(jt(e,t-257,5),jt(e,i-1,5),jt(e,n-4,4),r=0;r<n;r++)jt(e,e.bl_tree[2*Tt[r]+1],3);ei(e,e.dyn_ltree,t-1),ei(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Jt(e,e.dyn_ltree,e.dyn_dtree)),Kt(e),n&&Xt(e)},_tr_tally:(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(Rt[i]+256+1)]++,e.dyn_dtree[2*Gt(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{jt(e,2,3),Ht(e,256,Ot),(e=>{16===e.bi_valid?(Vt(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},ri=(e,t,i,n)=>{let r=65535&e,a=e>>>16&65535,s=0;for(;0!==i;){s=i>2e3?2e3:i,i-=s;do{r=r+t[n++]|0,a=a+r|0}while(--s);r%=65521,a%=65521}return r|a<<16};const ai=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var si=(e,t,i,n)=>{const r=ai,a=n+i;e^=-1;for(let i=n;i<a;i++)e=e>>>8^r[255&(e^t[i])];return~e},oi={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},li={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:hi,_tr_stored_block:ui,_tr_flush_block:ci,_tr_tally:di,_tr_align:fi}=ni,{Z_NO_FLUSH:pi,Z_PARTIAL_FLUSH:gi,Z_FULL_FLUSH:mi,Z_FINISH:bi,Z_BLOCK:wi,Z_OK:yi,Z_STREAM_END:_i,Z_STREAM_ERROR:ki,Z_DATA_ERROR:Si,Z_BUF_ERROR:vi,Z_DEFAULT_COMPRESSION:Ci,Z_FILTERED:xi,Z_HUFFMAN_ONLY:Ai,Z_RLE:Ii,Z_FIXED:Pi,Z_DEFAULT_STRATEGY:Ti,Z_UNKNOWN:Oi,Z_DEFLATED:Di}=li,Ui=258,Ri=262,Ei=42,Li=113,Mi=666,Fi=(e,t)=>(e.msg=oi[t],t),zi=e=>2*e-(e>4?9:0),Bi=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Ni=e=>{let t,i,n,r=e.w_size;t=e.hash_size,n=t;do{i=e.head[--n],e.head[n]=i>=r?i-r:0}while(--t);t=r,n=t;do{i=e.prev[--n],e.prev[n]=i>=r?i-r:0}while(--t)};let Gi=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const Vi=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},ji=(e,t)=>{ci(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Vi(e.strm)},Hi=(e,t)=>{e.pending_buf[e.pending++]=t},Zi=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Wi=(e,t,i,n)=>{let r=e.avail_in;return r>n&&(r=n),0===r?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),i),1===e.state.wrap?e.adler=ri(e.adler,t,r,i):2===e.state.wrap&&(e.adler=si(e.adler,t,r,i)),e.next_in+=r,e.total_in+=r,r)},Ki=(e,t)=>{let i,n,r=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-Ri?e.strstart-(e.w_size-Ri):0,h=e.window,u=e.w_mask,c=e.prev,d=e.strstart+Ui;let f=h[a+s-1],p=h[a+s];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do{if(i=t,h[i+s]===p&&h[i+s-1]===f&&h[i]===h[a]&&h[++i]===h[a+1]){a+=2,i++;do{}while(h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&a<d);if(n=Ui-(d-a),a=d-Ui,n>s){if(e.match_start=t,s=n,n>=o)break;f=h[a+s-1],p=h[a+s]}}}while((t=c[t&u])>l&&0!=--r);return s<=e.lookahead?s:e.lookahead},Xi=e=>{const t=e.w_size;let i,n,r;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ri)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Ni(e),n+=t),0===e.strm.avail_in)break;if(i=Wi(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=i,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=Gi(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=Gi(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ri&&0!==e.strm.avail_in)},Yi=(e,t)=>{let i,n,r,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(i=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r)break;if(r=e.strm.avail_out-r,n=e.strstart-e.block_start,i>n+e.strm.avail_in&&(i=n+e.strm.avail_in),i>r&&(i=r),i<a&&(0===i&&t!==bi||t===pi||i!==n+e.strm.avail_in))break;s=t===bi&&i===n+e.strm.avail_in?1:0,ui(e,0,0,s),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,Vi(e.strm),n&&(n>i&&(n=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,i-=n),i&&(Wi(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(0===s);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==pi&&t!==bi&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(Wi(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,a=r>e.w_size?e.w_size:r,n=e.strstart-e.block_start,(n>=a||(n||t===bi)&&t!==pi&&0===e.strm.avail_in&&n<=r)&&(i=n>r?r:n,s=t===bi&&0===e.strm.avail_in&&i===n?1:0,ui(e,e.block_start,i,s),e.block_start+=i,Vi(e.strm)),s?3:1)},$i=(e,t)=>{let i,n;for(;;){if(e.lookahead<Ri){if(Xi(e),e.lookahead<Ri&&t===pi)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=Gi(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-Ri&&(e.match_length=Ki(e,i)),e.match_length>=3)if(n=di(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Gi(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Gi(e,e.ins_h,e.window[e.strstart+1]);else n=di(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(ji(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===bi?(ji(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ji(e,!1),0===e.strm.avail_out)?1:2},Ji=(e,t)=>{let i,n,r;for(;;){if(e.lookahead<Ri){if(Xi(e),e.lookahead<Ri&&t===pi)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=Gi(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Ri&&(e.match_length=Ki(e,i),e.match_length<=5&&(e.strategy===xi||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,n=di(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=Gi(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(ji(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=di(e,0,e.window[e.strstart-1]),n&&ji(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=di(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===bi?(ji(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ji(e,!1),0===e.strm.avail_out)?1:2};function qi(e,t,i,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=r}const Qi=[new qi(0,0,0,0,Yi),new qi(4,4,8,4,$i),new qi(4,5,16,8,$i),new qi(4,6,32,32,$i),new qi(4,4,16,16,Ji),new qi(8,16,32,32,Ji),new qi(8,16,128,128,Ji),new qi(8,32,128,256,Ji),new qi(32,128,258,1024,Ji),new qi(32,258,258,4096,Ji)];function en(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Di,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Bi(this.dyn_ltree),Bi(this.dyn_dtree),Bi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Bi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Bi(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const tn=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Ei&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Li&&t.status!==Mi?1:0},nn=e=>{if(tn(e))return Fi(e,ki);e.total_in=e.total_out=0,e.data_type=Oi;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Ei:Li,e.adler=2===t.wrap?0:1,t.last_flush=-2,hi(t),yi},rn=e=>{const t=nn(e);return t===yi&&(e=>{e.window_size=2*e.w_size,Bi(e.head),e.max_lazy_match=Qi[e.level].max_lazy,e.good_match=Qi[e.level].good_length,e.nice_match=Qi[e.level].nice_length,e.max_chain_length=Qi[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},an=(e,t,i,n,r,a)=>{if(!e)return ki;let s=1;if(t===Ci&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),r<1||r>9||i!==Di||n<8||n>15||t<0||t>9||a<0||a>Pi||8===n&&1!==s)return Fi(e,ki);8===n&&(n=9);const o=new en;return e.state=o,o.strm=e,o.status=Ei,o.wrap=s,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=r+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<r+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=a,o.method=i,rn(e)};var sn=an,on=(e,t)=>tn(e)||2!==e.state.wrap?ki:(e.state.gzhead=t,yi),ln=(e,t)=>{if(tn(e)||t>wi||t<0)return e?Fi(e,ki):ki;const i=e.state;if(!e.output||0!==e.avail_in&&!e.input||i.status===Mi&&t!==bi)return Fi(e,0===e.avail_out?vi:ki);const n=i.last_flush;if(i.last_flush=t,0!==i.pending){if(Vi(e),0===e.avail_out)return i.last_flush=-1,yi}else if(0===e.avail_in&&zi(t)<=zi(n)&&t!==bi)return Fi(e,vi);if(i.status===Mi&&0!==e.avail_in)return Fi(e,vi);if(i.status===Ei&&0===i.wrap&&(i.status=Li),i.status===Ei){let t=Di+(i.w_bits-8<<4)<<8,n=-1;if(n=i.strategy>=Ai||i.level<2?0:i.level<6?1:6===i.level?2:3,t|=n<<6,0!==i.strstart&&(t|=32),t+=31-t%31,Zi(i,t),0!==i.strstart&&(Zi(i,e.adler>>>16),Zi(i,65535&e.adler)),e.adler=1,i.status=Li,Vi(e),0!==i.pending)return i.last_flush=-1,yi}if(57===i.status)if(e.adler=0,Hi(i,31),Hi(i,139),Hi(i,8),i.gzhead)Hi(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Hi(i,255&i.gzhead.time),Hi(i,i.gzhead.time>>8&255),Hi(i,i.gzhead.time>>16&255),Hi(i,i.gzhead.time>>24&255),Hi(i,9===i.level?2:i.strategy>=Ai||i.level<2?4:0),Hi(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Hi(i,255&i.gzhead.extra.length),Hi(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=si(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Hi(i,0),Hi(i,0),Hi(i,0),Hi(i,0),Hi(i,0),Hi(i,9===i.level?2:i.strategy>=Ai||i.level<2?4:0),Hi(i,3),i.status=Li,Vi(e),0!==i.pending)return i.last_flush=-1,yi;if(69===i.status){if(i.gzhead.extra){let t=i.pending,n=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+n>i.pending_buf_size;){let r=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+r),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>t&&(e.adler=si(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex+=r,Vi(e),0!==i.pending)return i.last_flush=-1,yi;t=0,n-=r}let r=new Uint8Array(i.gzhead.extra);i.pending_buf.set(r.subarray(i.gzindex,i.gzindex+n),i.pending),i.pending+=n,i.gzhead.hcrc&&i.pending>t&&(e.adler=si(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let t,n=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>n&&(e.adler=si(e.adler,i.pending_buf,i.pending-n,n)),Vi(e),0!==i.pending)return i.last_flush=-1,yi;n=0}t=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Hi(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>n&&(e.adler=si(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let t,n=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>n&&(e.adler=si(e.adler,i.pending_buf,i.pending-n,n)),Vi(e),0!==i.pending)return i.last_flush=-1,yi;n=0}t=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Hi(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>n&&(e.adler=si(e.adler,i.pending_buf,i.pending-n,n))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(Vi(e),0!==i.pending))return i.last_flush=-1,yi;Hi(i,255&e.adler),Hi(i,e.adler>>8&255),e.adler=0}if(i.status=Li,Vi(e),0!==i.pending)return i.last_flush=-1,yi}if(0!==e.avail_in||0!==i.lookahead||t!==pi&&i.status!==Mi){let n=0===i.level?Yi(i,t):i.strategy===Ai?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(Xi(e),0===e.lookahead)){if(t===pi)return 1;break}if(e.match_length=0,i=di(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(ji(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===bi?(ji(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ji(e,!1),0===e.strm.avail_out)?1:2})(i,t):i.strategy===Ii?((e,t)=>{let i,n,r,a;const s=e.window;for(;;){if(e.lookahead<=Ui){if(Xi(e),e.lookahead<=Ui&&t===pi)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=e.strstart-1,n=s[r],n===s[++r]&&n===s[++r]&&n===s[++r])){a=e.strstart+Ui;do{}while(n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&r<a);e.match_length=Ui-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=di(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=di(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(ji(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===bi?(ji(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ji(e,!1),0===e.strm.avail_out)?1:2})(i,t):Qi[i.level].func(i,t);if(3!==n&&4!==n||(i.status=Mi),1===n||3===n)return 0===e.avail_out&&(i.last_flush=-1),yi;if(2===n&&(t===gi?fi(i):t!==wi&&(ui(i,0,0,!1),t===mi&&(Bi(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Vi(e),0===e.avail_out))return i.last_flush=-1,yi}return t!==bi?yi:i.wrap<=0?_i:(2===i.wrap?(Hi(i,255&e.adler),Hi(i,e.adler>>8&255),Hi(i,e.adler>>16&255),Hi(i,e.adler>>24&255),Hi(i,255&e.total_in),Hi(i,e.total_in>>8&255),Hi(i,e.total_in>>16&255),Hi(i,e.total_in>>24&255)):(Zi(i,e.adler>>>16),Zi(i,65535&e.adler)),Vi(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?yi:_i)},hn=e=>{if(tn(e))return ki;const t=e.state.status;return e.state=null,t===Li?Fi(e,Si):yi},un=(e,t)=>{let i=t.length;if(tn(e))return ki;const n=e.state,r=n.wrap;if(2===r||1===r&&n.status!==Ei||n.lookahead)return ki;if(1===r&&(e.adler=ri(e.adler,t,i,0)),n.wrap=0,i>=n.w_size){0===r&&(Bi(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(i-n.w_size,i),0),t=e,i=n.w_size}const a=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Xi(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=Gi(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,Xi(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=s,e.input=o,e.avail_in=a,n.wrap=r,yi};const cn=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var dn=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)cn(i,t)&&(e[t]=i[t])}}return e},fn=e=>{let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,n=0,r=e.length;t<r;t++){let r=e[t];i.set(r,n),n+=r.length}return i};let pn=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){pn=!1}const gn=new Uint8Array(256);for(let e=0;e<256;e++)gn[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;gn[254]=gn[254]=1;var mn=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,n,r,a,s=e.length,o=0;for(r=0;r<s;r++)i=e.charCodeAt(r),55296==(64512&i)&&r+1<s&&(n=e.charCodeAt(r+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),o+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(o),a=0,r=0;a<o;r++)i=e.charCodeAt(r),55296==(64512&i)&&r+1<s&&(n=e.charCodeAt(r+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?t[a++]=i:i<2048?(t[a++]=192|i>>>6,t[a++]=128|63&i):i<65536?(t[a++]=224|i>>>12,t[a++]=128|i>>>6&63,t[a++]=128|63&i):(t[a++]=240|i>>>18,t[a++]=128|i>>>12&63,t[a++]=128|i>>>6&63,t[a++]=128|63&i);return t},bn=(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,r;const a=new Array(2*i);for(r=0,n=0;n<i;){let t=e[n++];if(t<128){a[r++]=t;continue}let s=gn[t];if(s>4)a[r++]=65533,n+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&n<i;)t=t<<6|63&e[n++],s--;s>1?a[r++]=65533:t<65536?a[r++]=t:(t-=65536,a[r++]=55296|t>>10&1023,a[r++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&pn)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i})(a,r)},wn=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+gn[e[i]]>t?i:t},yn=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const _n=Object.prototype.toString,{Z_NO_FLUSH:kn,Z_SYNC_FLUSH:Sn,Z_FULL_FLUSH:vn,Z_FINISH:Cn,Z_OK:xn,Z_STREAM_END:An,Z_DEFAULT_COMPRESSION:In,Z_DEFAULT_STRATEGY:Pn,Z_DEFLATED:Tn}=li;function On(e){this.options=dn({level:In,method:Tn,chunkSize:16384,windowBits:15,memLevel:8,strategy:Pn},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new yn,this.strm.avail_out=0;let i=sn(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==xn)throw new Error(oi[i]);if(t.header&&on(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?mn(t.dictionary):"[object ArrayBuffer]"===_n.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=un(this.strm,e),i!==xn)throw new Error(oi[i]);this._dict_set=!0}}function Dn(e,t){const i=new On(t);if(i.push(e,!0),i.err)throw i.msg||oi[i.err];return i.result}On.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize;let r,a;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Cn:kn,"string"==typeof e?i.input=mn(e):"[object ArrayBuffer]"===_n.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),(a===Sn||a===vn)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(r=ln(i,a),r===An)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),r=hn(this.strm),this.onEnd(r),this.ended=!0,r===xn;if(0!==i.avail_out){if(a>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},On.prototype.onData=function(e){this.chunks.push(e)},On.prototype.onEnd=function(e){e===xn&&(this.result=fn(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Un={Deflate:On,deflate:Dn,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Dn(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Dn(e,t)},constants:li};const Rn=16209;var En=function(e,t){let i,n,r,a,s,o,l,h,u,c,d,f,p,g,m,b,w,y,_,k,S,v,C,x;const A=e.state;i=e.next_in,C=e.input,n=i+(e.avail_in-5),r=e.next_out,x=e.output,a=r-(t-e.avail_out),s=r+(e.avail_out-257),o=A.dmax,l=A.wsize,h=A.whave,u=A.wnext,c=A.window,d=A.hold,f=A.bits,p=A.lencode,g=A.distcode,m=(1<<A.lenbits)-1,b=(1<<A.distbits)-1;e:do{f<15&&(d+=C[i++]<<f,f+=8,d+=C[i++]<<f,f+=8),w=p[d&m];t:for(;;){if(y=w>>>24,d>>>=y,f-=y,y=w>>>16&255,0===y)x[r++]=65535&w;else{if(!(16&y)){if(64&y){if(32&y){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=Rn;break e}w=p[(65535&w)+(d&(1<<y)-1)];continue t}for(_=65535&w,y&=15,y&&(f<y&&(d+=C[i++]<<f,f+=8),_+=d&(1<<y)-1,d>>>=y,f-=y),f<15&&(d+=C[i++]<<f,f+=8,d+=C[i++]<<f,f+=8),w=g[d&b];;){if(y=w>>>24,d>>>=y,f-=y,y=w>>>16&255,16&y){if(k=65535&w,y&=15,f<y&&(d+=C[i++]<<f,f+=8,f<y&&(d+=C[i++]<<f,f+=8)),k+=d&(1<<y)-1,k>o){e.msg="invalid distance too far back",A.mode=Rn;break e}if(d>>>=y,f-=y,y=r-a,k>y){if(y=k-y,y>h&&A.sane){e.msg="invalid distance too far back",A.mode=Rn;break e}if(S=0,v=c,0===u){if(S+=l-y,y<_){_-=y;do{x[r++]=c[S++]}while(--y);S=r-k,v=x}}else if(u<y){if(S+=l+u-y,y-=u,y<_){_-=y;do{x[r++]=c[S++]}while(--y);if(S=0,u<_){y=u,_-=y;do{x[r++]=c[S++]}while(--y);S=r-k,v=x}}}else if(S+=u-y,y<_){_-=y;do{x[r++]=c[S++]}while(--y);S=r-k,v=x}for(;_>2;)x[r++]=v[S++],x[r++]=v[S++],x[r++]=v[S++],_-=3;_&&(x[r++]=v[S++],_>1&&(x[r++]=v[S++]))}else{S=r-k;do{x[r++]=x[S++],x[r++]=x[S++],x[r++]=x[S++],_-=3}while(_>2);_&&(x[r++]=x[S++],_>1&&(x[r++]=x[S++]))}break}if(64&y){e.msg="invalid distance code",A.mode=Rn;break e}w=g[(65535&w)+(d&(1<<y)-1)]}}break}}while(i<n&&r<s);_=f>>3,i-=_,f-=_<<3,d&=(1<<f)-1,e.next_in=i,e.next_out=r,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=r<s?s-r+257:257-(r-s),A.hold=d,A.bits=f};const Ln=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Mn=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Fn=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),zn=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Bn=(e,t,i,n,r,a,s,o)=>{const l=o.bits;let h,u,c,d,f,p,g=0,m=0,b=0,w=0,y=0,_=0,k=0,S=0,v=0,C=0,x=null;const A=new Uint16Array(16),I=new Uint16Array(16);let P,T,O,D=null;for(g=0;g<=15;g++)A[g]=0;for(m=0;m<n;m++)A[t[i+m]]++;for(y=l,w=15;w>=1&&0===A[w];w--);if(y>w&&(y=w),0===w)return r[a++]=20971520,r[a++]=20971520,o.bits=1,0;for(b=1;b<w&&0===A[b];b++);for(y<b&&(y=b),S=1,g=1;g<=15;g++)if(S<<=1,S-=A[g],S<0)return-1;if(S>0&&(0===e||1!==w))return-1;for(I[1]=0,g=1;g<15;g++)I[g+1]=I[g]+A[g];for(m=0;m<n;m++)0!==t[i+m]&&(s[I[t[i+m]]++]=m);if(0===e?(x=D=s,p=20):1===e?(x=Ln,D=Mn,p=257):(x=Fn,D=zn,p=0),C=0,m=0,g=b,f=a,_=y,k=0,c=-1,v=1<<y,d=v-1,1===e&&v>852||2===e&&v>592)return 1;for(;;){P=g-k,s[m]+1<p?(T=0,O=s[m]):s[m]>=p?(T=D[s[m]-p],O=x[s[m]-p]):(T=96,O=0),h=1<<g-k,u=1<<_,b=u;do{u-=h,r[f+(C>>k)+u]=P<<24|T<<16|O}while(0!==u);for(h=1<<g-1;C&h;)h>>=1;if(0!==h?(C&=h-1,C+=h):C=0,m++,0==--A[g]){if(g===w)break;g=t[i+s[m]]}if(g>y&&(C&d)!==c){for(0===k&&(k=y),f+=b,_=g-k,S=1<<_;_+k<w&&(S-=A[_+k],!(S<=0));)_++,S<<=1;if(v+=1<<_,1===e&&v>852||2===e&&v>592)return 1;c=C&d,r[c]=y<<24|_<<16|f-a}}return 0!==C&&(r[f+C]=g-k<<24|64<<16),o.bits=y,0};const{Z_FINISH:Nn,Z_BLOCK:Gn,Z_TREES:Vn,Z_OK:jn,Z_STREAM_END:Hn,Z_NEED_DICT:Zn,Z_STREAM_ERROR:Wn,Z_DATA_ERROR:Kn,Z_MEM_ERROR:Xn,Z_BUF_ERROR:Yn,Z_DEFLATED:$n}=li,Jn=16180,qn=16190,Qn=16191,er=16192,tr=16194,ir=16199,nr=16200,rr=16206,ar=16209,sr=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function or(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const lr=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Jn||t.mode>16211?1:0},hr=e=>{if(lr(e))return Wn;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Jn,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,jn},ur=e=>{if(lr(e))return Wn;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,hr(e)},cr=(e,t)=>{let i;if(lr(e))return Wn;const n=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Wn:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,ur(e))},dr=(e,t)=>{if(!e)return Wn;const i=new or;e.state=i,i.strm=e,i.window=null,i.mode=Jn;const n=cr(e,t);return n!==jn&&(e.state=null),n};let fr,pr,gr=!0;const mr=e=>{if(gr){fr=new Int32Array(512),pr=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Bn(1,e.lens,0,288,fr,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Bn(2,e.lens,0,32,pr,0,e.work,{bits:5}),gr=!1}e.lencode=fr,e.lenbits=9,e.distcode=pr,e.distbits=5},br=(e,t,i,n)=>{let r;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(t.subarray(i-a.wsize,i),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>n&&(r=n),a.window.set(t.subarray(i-n,i-n+r),a.wnext),(n-=r)?(a.window.set(t.subarray(i-n,i),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0};var wr=ur,yr=dr,_r=(e,t)=>{let i,n,r,a,s,o,l,h,u,c,d,f,p,g,m,b,w,y,_,k,S,v,C=0;const x=new Uint8Array(4);let A,I;const P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(lr(e)||!e.output||!e.input&&0!==e.avail_in)return Wn;i=e.state,i.mode===Qn&&(i.mode=er),s=e.next_out,r=e.output,l=e.avail_out,a=e.next_in,n=e.input,o=e.avail_in,h=i.hold,u=i.bits,c=o,d=l,v=jn;e:for(;;)switch(i.mode){case Jn:if(0===i.wrap){i.mode=er;break}for(;u<16;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}if(2&i.wrap&&35615===h){0===i.wbits&&(i.wbits=15),i.check=0,x[0]=255&h,x[1]=h>>>8&255,i.check=si(i.check,x,2,0),h=0,u=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",i.mode=ar;break}if((15&h)!==$n){e.msg="unknown compression method",i.mode=ar;break}if(h>>>=4,u-=4,S=8+(15&h),0===i.wbits&&(i.wbits=S),S>15||S>i.wbits){e.msg="invalid window size",i.mode=ar;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&h?16189:Qn,h=0,u=0;break;case 16181:for(;u<16;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}if(i.flags=h,(255&i.flags)!==$n){e.msg="unknown compression method",i.mode=ar;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=ar;break}i.head&&(i.head.text=h>>8&1),512&i.flags&&4&i.wrap&&(x[0]=255&h,x[1]=h>>>8&255,i.check=si(i.check,x,2,0)),h=0,u=0,i.mode=16182;case 16182:for(;u<32;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}i.head&&(i.head.time=h),512&i.flags&&4&i.wrap&&(x[0]=255&h,x[1]=h>>>8&255,x[2]=h>>>16&255,x[3]=h>>>24&255,i.check=si(i.check,x,4,0)),h=0,u=0,i.mode=16183;case 16183:for(;u<16;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&i.flags&&4&i.wrap&&(x[0]=255&h,x[1]=h>>>8&255,i.check=si(i.check,x,2,0)),h=0,u=0,i.mode=16184;case 16184:if(1024&i.flags){for(;u<16;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}i.length=h,i.head&&(i.head.extra_len=h),512&i.flags&&4&i.wrap&&(x[0]=255&h,x[1]=h>>>8&255,i.check=si(i.check,x,2,0)),h=0,u=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(f=i.length,f>o&&(f=o),f&&(i.head&&(S=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(n.subarray(a,a+f),S)),512&i.flags&&4&i.wrap&&(i.check=si(i.check,n,f,a)),o-=f,a+=f,i.length-=f),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===o)break e;f=0;do{S=n[a+f++],i.head&&S&&i.length<65536&&(i.head.name+=String.fromCharCode(S))}while(S&&f<o);if(512&i.flags&&4&i.wrap&&(i.check=si(i.check,n,f,a)),o-=f,a+=f,S)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===o)break e;f=0;do{S=n[a+f++],i.head&&S&&i.length<65536&&(i.head.comment+=String.fromCharCode(S))}while(S&&f<o);if(512&i.flags&&4&i.wrap&&(i.check=si(i.check,n,f,a)),o-=f,a+=f,S)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;u<16;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}if(4&i.wrap&&h!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ar;break}h=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Qn;break;case 16189:for(;u<32;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}e.adler=i.check=sr(h),h=0,u=0,i.mode=qn;case qn:if(0===i.havedict)return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,i.hold=h,i.bits=u,Zn;e.adler=i.check=1,i.mode=Qn;case Qn:if(t===Gn||t===Vn)break e;case er:if(i.last){h>>>=7&u,u-=7&u,i.mode=rr;break}for(;u<3;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}switch(i.last=1&h,h>>>=1,u-=1,3&h){case 0:i.mode=16193;break;case 1:if(mr(i),i.mode=ir,t===Vn){h>>>=2,u-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=ar}h>>>=2,u-=2;break;case 16193:for(h>>>=7&u,u-=7&u;u<32;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ar;break}if(i.length=65535&h,h=0,u=0,i.mode=tr,t===Vn)break e;case tr:i.mode=16195;case 16195:if(f=i.length,f){if(f>o&&(f=o),f>l&&(f=l),0===f)break e;r.set(n.subarray(a,a+f),s),o-=f,a+=f,l-=f,s+=f,i.length-=f;break}i.mode=Qn;break;case 16196:for(;u<14;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}if(i.nlen=257+(31&h),h>>>=5,u-=5,i.ndist=1+(31&h),h>>>=5,u-=5,i.ncode=4+(15&h),h>>>=4,u-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ar;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;u<3;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}i.lens[P[i.have++]]=7&h,h>>>=3,u-=3}for(;i.have<19;)i.lens[P[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,A={bits:i.lenbits},v=Bn(0,i.lens,0,19,i.lencode,0,i.work,A),i.lenbits=A.bits,v){e.msg="invalid code lengths set",i.mode=ar;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;C=i.lencode[h&(1<<i.lenbits)-1],m=C>>>24,b=C>>>16&255,w=65535&C,!(m<=u);){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}if(w<16)h>>>=m,u-=m,i.lens[i.have++]=w;else{if(16===w){for(I=m+2;u<I;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}if(h>>>=m,u-=m,0===i.have){e.msg="invalid bit length repeat",i.mode=ar;break}S=i.lens[i.have-1],f=3+(3&h),h>>>=2,u-=2}else if(17===w){for(I=m+3;u<I;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}h>>>=m,u-=m,S=0,f=3+(7&h),h>>>=3,u-=3}else{for(I=m+7;u<I;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}h>>>=m,u-=m,S=0,f=11+(127&h),h>>>=7,u-=7}if(i.have+f>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ar;break}for(;f--;)i.lens[i.have++]=S}}if(i.mode===ar)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=ar;break}if(i.lenbits=9,A={bits:i.lenbits},v=Bn(1,i.lens,0,i.nlen,i.lencode,0,i.work,A),i.lenbits=A.bits,v){e.msg="invalid literal/lengths set",i.mode=ar;break}if(i.distbits=6,i.distcode=i.distdyn,A={bits:i.distbits},v=Bn(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,A),i.distbits=A.bits,v){e.msg="invalid distances set",i.mode=ar;break}if(i.mode=ir,t===Vn)break e;case ir:i.mode=nr;case nr:if(o>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,i.hold=h,i.bits=u,En(e,d),s=e.next_out,r=e.output,l=e.avail_out,a=e.next_in,n=e.input,o=e.avail_in,h=i.hold,u=i.bits,i.mode===Qn&&(i.back=-1);break}for(i.back=0;C=i.lencode[h&(1<<i.lenbits)-1],m=C>>>24,b=C>>>16&255,w=65535&C,!(m<=u);){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}if(b&&!(240&b)){for(y=m,_=b,k=w;C=i.lencode[k+((h&(1<<y+_)-1)>>y)],m=C>>>24,b=C>>>16&255,w=65535&C,!(y+m<=u);){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}h>>>=y,u-=y,i.back+=y}if(h>>>=m,u-=m,i.back+=m,i.length=w,0===b){i.mode=16205;break}if(32&b){i.back=-1,i.mode=Qn;break}if(64&b){e.msg="invalid literal/length code",i.mode=ar;break}i.extra=15&b,i.mode=16201;case 16201:if(i.extra){for(I=i.extra;u<I;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;C=i.distcode[h&(1<<i.distbits)-1],m=C>>>24,b=C>>>16&255,w=65535&C,!(m<=u);){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}if(!(240&b)){for(y=m,_=b,k=w;C=i.distcode[k+((h&(1<<y+_)-1)>>y)],m=C>>>24,b=C>>>16&255,w=65535&C,!(y+m<=u);){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}h>>>=y,u-=y,i.back+=y}if(h>>>=m,u-=m,i.back+=m,64&b){e.msg="invalid distance code",i.mode=ar;break}i.offset=w,i.extra=15&b,i.mode=16203;case 16203:if(i.extra){for(I=i.extra;u<I;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ar;break}i.mode=16204;case 16204:if(0===l)break e;if(f=d-l,i.offset>f){if(f=i.offset-f,f>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ar;break}f>i.wnext?(f-=i.wnext,p=i.wsize-f):p=i.wnext-f,f>i.length&&(f=i.length),g=i.window}else g=r,p=s-i.offset,f=i.length;f>l&&(f=l),l-=f,i.length-=f;do{r[s++]=g[p++]}while(--f);0===i.length&&(i.mode=nr);break;case 16205:if(0===l)break e;r[s++]=i.length,l--,i.mode=nr;break;case rr:if(i.wrap){for(;u<32;){if(0===o)break e;o--,h|=n[a++]<<u,u+=8}if(d-=l,e.total_out+=d,i.total+=d,4&i.wrap&&d&&(e.adler=i.check=i.flags?si(i.check,r,d,s-d):ri(i.check,r,d,s-d)),d=l,4&i.wrap&&(i.flags?h:sr(h))!==i.check){e.msg="incorrect data check",i.mode=ar;break}h=0,u=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;u<32;){if(0===o)break e;o--,h+=n[a++]<<u,u+=8}if(4&i.wrap&&h!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ar;break}h=0,u=0}i.mode=16208;case 16208:v=Hn;break e;case ar:v=Kn;break e;case 16210:return Xn;default:return Wn}return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,i.hold=h,i.bits=u,(i.wsize||d!==e.avail_out&&i.mode<ar&&(i.mode<rr||t!==Nn))&&br(e,e.output,e.next_out,d-e.avail_out),c-=e.avail_in,d-=e.avail_out,e.total_in+=c,e.total_out+=d,i.total+=d,4&i.wrap&&d&&(e.adler=i.check=i.flags?si(i.check,r,d,e.next_out-d):ri(i.check,r,d,e.next_out-d)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Qn?128:0)+(i.mode===ir||i.mode===tr?256:0),(0===c&&0===d||t===Nn)&&v===jn&&(v=Yn),v},kr=e=>{if(lr(e))return Wn;let t=e.state;return t.window&&(t.window=null),e.state=null,jn},Sr=(e,t)=>{if(lr(e))return Wn;const i=e.state;return 2&i.wrap?(i.head=t,t.done=!1,jn):Wn},vr=(e,t)=>{const i=t.length;let n,r,a;return lr(e)?Wn:(n=e.state,0!==n.wrap&&n.mode!==qn?Wn:n.mode===qn&&(r=1,r=ri(r,t,i,0),r!==n.check)?Kn:(a=br(e,t,i,i),a?(n.mode=16210,Xn):(n.havedict=1,jn)))},Cr=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const xr=Object.prototype.toString,{Z_NO_FLUSH:Ar,Z_FINISH:Ir,Z_OK:Pr,Z_STREAM_END:Tr,Z_NEED_DICT:Or,Z_STREAM_ERROR:Dr,Z_DATA_ERROR:Ur,Z_MEM_ERROR:Rr}=li;function Er(e){this.options=dn({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new yn,this.strm.avail_out=0;let i=yr(this.strm,t.windowBits);if(i!==Pr)throw new Error(oi[i]);if(this.header=new Cr,Sr(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=mn(t.dictionary):"[object ArrayBuffer]"===xr.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=vr(this.strm,t.dictionary),i!==Pr)))throw new Error(oi[i])}function Lr(e,t){const i=new Er(t);if(i.push(e),i.err)throw i.msg||oi[i.err];return i.result}Er.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let a,s,o;if(this.ended)return!1;for(s=t===~~t?t:!0===t?Ir:Ar,"[object ArrayBuffer]"===xr.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),a=_r(i,s),a===Or&&r&&(a=vr(i,r),a===Pr?a=_r(i,s):a===Ur&&(a=Or));i.avail_in>0&&a===Tr&&i.state.wrap>0&&0!==e[i.next_in];)wr(i),a=_r(i,s);switch(a){case Dr:case Ur:case Or:case Rr:return this.onEnd(a),this.ended=!0,!1}if(o=i.avail_out,i.next_out&&(0===i.avail_out||a===Tr))if("string"===this.options.to){let e=wn(i.output,i.next_out),t=i.next_out-e,r=bn(i.output,e);i.next_out=t,i.avail_out=n-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(r)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(a!==Pr||0!==o){if(a===Tr)return a=kr(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},Er.prototype.onData=function(e){this.chunks.push(e)},Er.prototype.onEnd=function(e){e===Pr&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=fn(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Mr={Inflate:Er,inflate:Lr,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Lr(e,t)},ungzip:Lr,constants:li};const{Deflate:Fr,deflate:zr,deflateRaw:Br,gzip:Nr}=Un,{Inflate:Gr,inflate:Vr,inflateRaw:jr,ungzip:Hr}=Mr;var Zr={Deflate:Fr,deflate:zr,deflateRaw:Br,gzip:Nr,Inflate:Gr,inflate:Vr,inflateRaw:jr,ungzip:Hr,constants:li};function Wr(e,t,i,n,r,a,s){try{var o=e[a](s),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function Kr(){var e;return e=function(e){var t,i,n,r,a,s,o,l,h,u,c,d,f,p,g,m,b,w,y,_;return function(e,t){var i,n,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}(this,(function(k){switch(k.label){case 0:return[4,e.arrayBuffer()];case 1:for(t=k.sent(),i=new DataView(t),n=8,r={};n<i.byteLength;){if(a=i.getUint32(n),"tEXt"===(s=String.fromCharCode(i.getUint8(n+4),i.getUint8(n+5),i.getUint8(n+6),i.getUint8(n+7))))o=new Uint8Array(t,n+8,a),l=(new TextDecoder).decode(o),-1!==(h=l.indexOf("\0"))&&(u=l.slice(0,h),c=l.slice(h+1),r[u]=c);else if("iTXt"===s){if(d=new Uint8Array(t,n+8,a),f=0,-1===(p=d.indexOf(0,f)))continue;if(g=(new TextDecoder).decode(d.slice(f,p)),m=d[f=p+1],f+=2,-1===(b=d.indexOf(0,f)))continue;if(f=b+1,-1===(w=d.indexOf(0,f)))continue;f=w+1,y=d.slice(f),_=(new TextDecoder).decode(m?Zr.inflate(y):y),r[g]=_}n+=8+a+4}return[2,r]}}))},Kr=function(){var t=this,i=arguments;return new Promise((function(n,r){var a=e.apply(t,i);function s(e){Wr(a,n,r,s,o,"next",e)}function o(e){Wr(a,n,r,s,o,"throw",e)}s(void 0)}))},Kr.apply(this,arguments)}const Xr=function(e){return Kr.apply(this,arguments)};class Yr extends Error{constructor(e,t){super("".concat(e," at position ").concat(t)),this.position=t}}function $r(e){return/^[0-9A-Fa-f]$/.test(e)}function Jr(e){return e>="0"&&e<="9"}function qr(e){return e>=" "}function Qr(e){return",:[]/{}()\n+".includes(e)}function ea(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||"_"===e||"$"===e}function ta(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||"_"===e||"$"===e||e>="0"&&e<="9"}const ia=/^(http|https|ftp|mailto|file|data|irc):\/\/$/,na=/^[A-Za-z0-9-._~:/?#@!$&'()*+;=]$/;function ra(e){return",[]/{}\n+".includes(e)}function aa(e){return ca(e)||sa.test(e)}const sa=/^[[{\w-]$/;function oa(e){return"\n"===e||"\r"===e||"\t"===e||"\b"===e||"\f"===e}function la(e,t){const i=e.charCodeAt(t);return 32===i||10===i||9===i||13===i}function ha(e,t){const i=e.charCodeAt(t);return 32===i||9===i||13===i}function ua(e,t){const i=e.charCodeAt(t);return 160===i||i>=8192&&i<=8202||8239===i||8287===i||12288===i}function ca(e){return da(e)||pa(e)}function da(e){return'"'===e||"“"===e||"”"===e}function fa(e){return'"'===e}function pa(e){return"'"===e||"‘"===e||"’"===e||"`"===e||"´"===e}function ga(e){return"'"===e}function ma(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=e.lastIndexOf(t);return-1!==n?e.substring(0,n)+(i?"":e.substring(n+1)):e}function ba(e,t){let i=e.length;if(!la(e,i-1))return e+t;for(;la(e,i-1);)i--;return e.substring(0,i)+t+e.substring(i)}function wa(e,t,i){return e.substring(0,t)+e.substring(t+i)}const ya={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},_a={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function ka(e,t){return"*"===e[t]&&"/"===e[t+1]}function Sa(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function va(e){return e.toString().replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Ca=function(e){if("string"!=typeof e)return e;if(e.startsWith("{"))try{var t=JSON.parse(function(e){let t=0,i="";l(),r()||function(){throw new Yr("Unexpected end of json string",e.length)}(),l();const n=h(",");for(n&&a(),aa(e[t])&&function(e){return/[,\n][ \t\r]*$/.test(e)}(i)?(n||(i=ba(i,",")),function(){let e=!0,t=!0;for(;t;)e?e=!1:h(",")||(i=ba(i,",")),t=r();t||(i=ma(i,",")),i="[\n".concat(i,"\n]")}()):n&&(i=ma(i,","));"}"===e[t]||"]"===e[t];)t++,a();if(t>=e.length)return i;function r(){a();const n=function(){if("{"===e[t]){i+="{",t++,a(),u(",")&&a();let n=!0;for(;t<e.length&&"}"!==e[t];){let s;if(n?(s=!0,n=!1):(s=h(","),s||(i=ba(i,",")),a()),c(),!d()&&!g(!0)){"}"===e[t]||"{"===e[t]||"]"===e[t]||"["===e[t]||void 0===e[t]?i=ma(i,","):_();break}a();const o=h(":"),l=t>=e.length;o||(aa(e[t])||l?i=ba(i,":"):k()),r()||(o||l?i+="null":k())}return"}"===e[t]?(i+="}",t++):i=ba(i,"}"),!0}return!1}()||function(){if("["===e[t]){i+="[",t++,a(),u(",")&&a();let n=!0;for(;t<e.length&&"]"!==e[t];)if(n?n=!1:h(",")||(i=ba(i,",")),c(),!r()){i=ma(i,",");break}return"]"===e[t]?(i+="]",t++):i=ba(i,"]"),!0}return!1}()||d()||function(){const n=t;if("-"===e[t]){if(t++,b())return w(n),!0;if(!Jr(e[t]))return t=n,!1}for(;Jr(e[t]);)t++;if("."===e[t]){if(t++,b())return w(n),!0;if(!Jr(e[t]))return t=n,!1;for(;Jr(e[t]);)t++}if("e"===e[t]||"E"===e[t]){if(t++,"-"!==e[t]&&"+"!==e[t]||t++,b())return w(n),!0;if(!Jr(e[t]))return t=n,!1;for(;Jr(e[t]);)t++}if(!b())return t=n,!1;if(t>n){const r=e.slice(n,t),a=/^0\d/.test(r);return i+=a?'"'.concat(r,'"'):r,!0}return!1}()||p("true","true")||p("false","false")||p("null","null")||p("True","true")||p("False","false")||p("None","null")||g(!1)||function(){if("/"===e[t]){const n=t;for(t++;t<e.length&&("/"!==e[t]||"\\"===e[t-1]);)t++;return t++,i+='"'.concat(e.substring(n,t),'"'),!0}}();return a(),n}function a(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const i=t;let n=s(e);do{n=o(),n&&(n=s(e))}while(n);return t>i}function s(n){const r=n?la:ha;let a="";for(;;)if(r(e,t))a+=e[t],t++;else{if(!ua(e,t))break;a+=" ",t++}return a.length>0&&(i+=a,!0)}function o(){if("/"===e[t]&&"*"===e[t+1]){for(;t<e.length&&!ka(e,t);)t++;return t+=2,!0}if("/"===e[t]&&"/"===e[t+1]){for(;t<e.length&&"\n"!==e[t];)t++;return!0}return!1}function l(){if("```"===e.slice(t,t+3)){if(t+=3,ea(e[t]))for(;t<e.length&&ta(e[t]);)t++;return a(),!0}return!1}function h(n){return e[t]===n&&(i+=e[t],t++,!0)}function u(i){return e[t]===i&&(t++,!0)}function c(){return a(),"."===e[t]&&"."===e[t+1]&&"."===e[t+2]&&(t+=3,a(),u(","),!0)}function d(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,s="\\"===e[t];if(s&&(t++,s=!0),ca(e[t])){const o=fa(e[t])?fa:ga(e[t])?ga:pa(e[t])?pa:da,l=t,h=i.length;let c='"';for(t++;;){if(t>=e.length){const r=m(t-1);return!n&&Qr(e.charAt(r))?(t=l,i=i.substring(0,h),d(!0)):(c=ba(c,'"'),i+=c,!0)}if(t===r)return c=ba(c,'"'),i+=c,!0;if(o(e[t])){const r=t,s=c.length;if(c+='"',t++,i+=c,a(!1),n||t>=e.length||Qr(e[t])||ca(e[t])||Jr(e[t]))return f(),!0;const o=m(r-1),u=e.charAt(o);if(","===u)return t=l,i=i.substring(0,h),d(!1,o);if(Qr(u))return t=l,i=i.substring(0,h),d(!0);i=i.substring(0,h),t=r+1,c="".concat(c.substring(0,s),"\\").concat(c.substring(s))}else{if(n&&ra(e[t])){if(":"===e[t-1]&&ia.test(e.substring(l+1,t+2)))for(;t<e.length&&na.test(e[t]);)c+=e[t],t++;return c=ba(c,'"'),i+=c,f(),!0}if("\\"===e[t]){const i=e.charAt(t+1);if(void 0!==_a[i])c+=e.slice(t,t+2),t+=2;else if("u"===i){let i=2;for(;i<6&&$r(e[t+i]);)i++;6===i?(c+=e.slice(t,t+6),t+=6):t+i>=e.length?t=e.length:S()}else c+=i,t+=2}else{const i=e.charAt(t);'"'===i&&"\\"!==e[t-1]?(c+="\\".concat(i),t++):oa(i)?(c+=ya[i],t++):(qr(i)||y(i),c+=i,t++)}}s&&u("\\")}}return!1}function f(){let n=!1;for(a();"+"===e[t];){n=!0,t++,a(),i=ma(i,'"',!0);const e=i.length,r=d();i=r?wa(i,e,1):ba(i,'"')}return n}function p(n,r){return e.slice(t,t+n.length)===n&&(i+=r,t+=n.length,!0)}function g(n){const a=t;if(ea(e[t])){for(;t<e.length&&ta(e[t]);)t++;let i=t;for(;la(e,i);)i++;if("("===e[i])return t=i+1,r(),")"===e[t]&&(t++,";"===e[t]&&t++),!0}for(;t<e.length&&!ra(e[t])&&!ca(e[t])&&(!n||":"!==e[t]);)t++;if(":"===e[t-1]&&ia.test(e.substring(a,t+2)))for(;t<e.length&&na.test(e[t]);)t++;if(t>a){for(;la(e,t-1)&&t>0;)t--;const n=e.slice(a,t);return i+="undefined"===n?"null":JSON.stringify(n),'"'===e[t]&&t++,!0}}function m(t){let i=t;for(;i>0&&la(e,i);)i--;return i}function b(){return t>=e.length||Qr(e[t])||la(e,t)}function w(n){i+="".concat(e.slice(n,t),"0")}function y(e){throw new Yr("Invalid character ".concat(JSON.stringify(e)),t)}function _(){throw new Yr("Object key expected",t)}function k(){throw new Yr("Colon expected",t)}function S(){const i=e.slice(t,t+6);throw new Yr('Invalid unicode character "'.concat(i,'"'),t)}!function(){throw new Yr("Unexpected character ".concat(JSON.stringify(e[t])),t)}()}(e));return"<code>"+va(JSON.stringify(t,null,2))+"</code>"}catch(e){}if(e.includes("Negative prompt"))try{var i=function(e){var t=e.split(/\n(Negative prompt|Steps): /,5);if(5!==t.length)throw"unknown prompt format";var i={prompt:t[0],"negative prompt":t[2]};return t[4]="Steps: "+t[4],t[4].match(/[a-zA-Z0-9 ]+: (\{.*?\}|[^\{\}:,]+)(, |$)/g).forEach((function(e){var t=e.split(/: (.+)/,2);if(2===t.length&&(i[t[0]]=t[1].replace(/, $/,""),i[t[0]].startsWith("{")))try{var n=JSON.stringify(JSON.parse(i[t[0]]),null,2);i[t[0]]=n}catch(e){}})),"<table>"+Object.entries(i).map((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,a=[],s=!0,o=!1;try{for(i=i.call(e);!(s=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);s=!0);}catch(e){o=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(o)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Sa(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Sa(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),i=t[0],n=t[1];return'<tr class="prompt-part"><td><b>'.concat(i,"</b></td><td><code>").concat(va(n),"</code></td></tr>")})).join("")+'</table><span class="png-text-chunk-key">raw parameters: </span>'+va(e)}(e);return i}catch(e){console.error(e)}return va(e)},xa=function(e,t){var i=!1,n=document.createElement("div");n.id="png-text-button",n.classList.add("metadata-preview-button"),n.textContent=t,n.addEventListener("click",(function(){i?r.classList.remove("active"):r.classList.add("active"),i=!i}));var r=document.createElement("div");for(var a in r.id="png-text-chunks",e){var s=document.createElement("div");s.classList.add("png-text-chunk"),s.innerHTML='<span class="png-text-chunk-key">'.concat(a,':</span> <span class="png-text-chunk-value">').concat(Ca(e[a]),"</span>"),r.appendChild(s)}document.getElementById("metadata-preview-buttons").appendChild(n),document.body.appendChild(r)};function Aa(e,t,i,n,r,a,s){try{var o=e[a](s),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function Ia(){var e;return e=function(e){var t,i,n;return function(e,t){var i,n,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}(this,(function(r){switch(r.label){case 0:return[4,e.arrayBuffer()];case 1:t=r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),n=function(e){for(var t=new DataView(e),i=t.byteLength,n=12;n<i-8;){var r=String.fromCharCode(t.getUint8(n),t.getUint8(n+1),t.getUint8(n+2),t.getUint8(n+3)),a=t.getUint32(n+4,!0);if("EXIF"===r){var s=n+8,o=s+a,l=new Uint8Array(e.slice(s,o));return 69===l[0]&&120===l[1]&&105===l[2]&&102===l[3]&&0===l[4]&&0===l[5]?l.slice(6):(console.warn('EXIF chunk does not start with "Exif\\0\\0"'),null)}n+=8+a+a%2}return null}(t),[4,ae(n,{userComment:!0})];case 3:return i=r.sent(),[3,5];case 4:return r.sent(),[3,5];case 5:return i?[2,kt(i)]:[2,{}]}}))},Ia=function(){var t=this,i=arguments;return new Promise((function(n,r){var a=e.apply(t,i);function s(e){Aa(a,n,r,s,o,"next",e)}function o(e){Aa(a,n,r,s,o,"throw",e)}s(void 0)}))},Ia.apply(this,arguments)}const Pa=function(e){return Ia.apply(this,arguments)};function Ta(e,t,i,n,r,a,s){try{var o=e[a](s),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(n,r)}var Oa;(Oa=function(){var e,t,i,n,a,s,o,l,h,u;return function(e,t){var i,n,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}(this,(function(c){switch(c.label){case 0:e=document.location.href.split("?")[0].toLowerCase(),(t=document.createElement("div")).id="metadata-preview-buttons",document.body.appendChild(t),i=!1,c.label=1;case 1:return c.trys.push([1,11,,12]),[4,fetch(document.location.href)];case 2:return n=c.sent(),e.endsWith(".jpg")||e.endsWith(".jpeg")?[4,Ct(n)]:[3,4];case 3:return a=c.sent(),(i=Object.values(a).length>0)&&xa(a,"EXIF"),[3,10];case 4:return e.endsWith(".webp")?[4,Pa(n)]:[3,6];case 5:return s=c.sent(),(i=Object.values(s).length>0)&&xa(s,"EXIF"),[3,10];case 6:return e.endsWith(".png")?[4,Xr(n)]:[3,10];case 7:return o=c.sent(),(i=Object.values(o).length>0)?(xa(o,"tEXt"),[3,10]):[3,8];case 8:return[4,r(n)];case 9:l=c.sent(),(i=l&&Object.values(l).length>0)&&xa(l,"alpha"),c.label=10;case 10:return[3,12];case 11:return h=c.sent(),console.warn("Couldn't fetch the image",h.message),[3,12];case 12:return i?((u=document.createElement("style")).textContent="\n#metadata-preview-buttons {\n  position: fixed;\n  z-index: 1;\n  top: .5rem;\n  left: .5rem;\n  font-family: monospace;\n  font-weight: 700;\n  font-size: .8rem;\n}\n\n.metadata-preview-button {\n  padding: .25em .5em;\n  background-color: #111d;\n  color: #fff;\n  border: 1px solid #999;\n  box-shadow: 0 0 0 1px #111;\n  cursor: pointer;\n}\n\n.metadata-preview-button:hover {\n  background-color: #333;\n}\n\n#png-text-chunks {\n  display: none;\n  position:fixed;\n  font-family: monospace;\n  box-sizing: border-box;\n  padding: 2rem .5rem .5rem .5rem;\n  background-color: #111d;\n  color: #fff;\n  width: 60rem;\n  max-width: 100%;\n  height: 100%;\n  overflow: scroll;\n\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n  }\n\n#png-text-chunks code {\n  white-space: pre-wrap;\n}\n\n#png-text-chunks::-webkit-scrollbar {\n  display: none;\n}\n\n#png-text-chunks.active {\n  display: block;\n}\n\n.png-text-chunk {\n  padding: .5rem;\n  border-bottom: 1px solid #555;\n}\n\n.png-text-chunk:last-child {\n  border: none;\n}\n\ntable {\n  border-collapse: collapse;\n}\n\n.prompt-part td {\n  border-top: 1px solid #333;\n  padding: .3em;\n}\n\n.prompt-part:first-child td {\n  border-top: none;\n}\n\n.prompt-part td:first-child {\n  white-space: pre;\n  text-align: center;\n  background-color: #222;\n}\n\n.prompt-part b {\n  padding: 0 .5em .1em .5em;\n  border-radius: 5px;\n}\n",document.body.appendChild(u),[2]):[2]}}))},function(){var e=this,t=arguments;return new Promise((function(i,n){var r=Oa.apply(e,t);function a(e){Ta(r,i,n,a,s,"next",e)}function s(e){Ta(r,i,n,a,s,"throw",e)}a(void 0)}))})()})();